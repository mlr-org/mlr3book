<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.272">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<title>Applied Machine Learning Using mlr3 in R - 7&nbsp; Sequential Pipelines</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>

<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../chapters/chapter8/non-sequential_pipelines_and_tuning.html" rel="next">
<link href="../../chapters/chapter6/feature_selection.html" rel="prev">
<link href="../../Figures/favicon.ico" rel="icon">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light"><script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script><style>html{ scroll-behavior: smooth; }</style>
</head>
<body class="nav-sidebar floating slimcontent">


<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="quarto-secondary-nav"><div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../chapters/chapter7/sequential_pipelines.html">Pipelines and Preprocessing</a></li><li class="breadcrumb-item"><a href="../../chapters/chapter7/sequential_pipelines.html"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Sequential Pipelines</span></a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto"><div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="../../">Applied Machine Learning Using mlr3 in R</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/mlr-org/mlr3book/tree/main/book/" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
    <a href="../../Applied-Machine-Learning-Using-mlr3-in-R.pdf" title="Download PDF" class="quarto-navigation-tool px-1" aria-label="Download PDF"><i class="bi bi-file-pdf"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Getting Started</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/chapter1/introduction_and_overview.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction and Overview</span></span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="false">
 <span class="menu-text">Fundamentals</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 ">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/chapter2/data_and_basic_modeling.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Data and Basic Modeling</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/chapter3/evaluation_and_benchmarking.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Evaluation and Benchmarking</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="false">
 <span class="menu-text">Tuning and Feature Selection</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 ">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/chapter4/hyperparameter_optimization.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Hyperparameter Optimization</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/chapter5/advanced_tuning_methods_and_black_box_optimization.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Advanced Tuning Methods and Black Box Optimization</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/chapter6/feature_selection.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Feature Selection</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">
 <span class="menu-text">Pipelines and Preprocessing</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/chapter7/sequential_pipelines.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Sequential Pipelines</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/chapter8/non-sequential_pipelines_and_tuning.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Non-sequential Pipelines and Tuning</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/chapter9/preprocessing.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Preprocessing</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="false">
 <span class="menu-text">Advanced Topics</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 ">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/chapter10/advanced_technical_aspects_of_mlr3.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Advanced Technical Aspects of mlr3</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/chapter11/large-scale_benchmarking.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Large-Scale Benchmarking</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/chapter12/model_interpretation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Model Interpretation</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/chapter13/beyond_regression_and_classification.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Beyond Regression and Classification</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/chapter14/algorithmic_fairness.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Algorithmic Fairness</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="false">
 <span class="menu-text">Appendices</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 ">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/appendices/citation_information.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">A</span>&nbsp; <span class="chapter-title">Citation Information</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/appendices/session_info.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">B</span>&nbsp; <span class="chapter-title">Session Info</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/appendices/solutions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">C</span>&nbsp; <span class="chapter-title">Solutions to exercises</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/appendices/tasks.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">D</span>&nbsp; <span class="chapter-title">Tasks</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/appendices/overview-tables.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">E</span>&nbsp; <span class="chapter-title">Overview Tables</span></span></a>
  </div>
</li>
          <li class="px-0"><hr class="sidebar-divider hi "></li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/appendices/references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">F</span>&nbsp; <span class="chapter-title">References</span></span></a>
  </div>
</li>
      </ul>
</li>
    </ul>
</div>
</nav><div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">Table of contents</h2>
   
  <ul>
<li><a href="#sec-pipelines-pipeops" id="toc-sec-pipelines-pipeops" class="nav-link active" data-scroll-target="#sec-pipelines-pipeops"><span class="header-section-number">7.1</span> PipeOp: Pipeline Operators</a></li>
  <li><a href="#sec-pipelines-graphs" id="toc-sec-pipelines-graphs" class="nav-link" data-scroll-target="#sec-pipelines-graphs"><span class="header-section-number">7.2</span> Graph: Networks of PipeOps</a></li>
  <li>
<a href="#sec-pipelines-sequential" id="toc-sec-pipelines-sequential" class="nav-link" data-scroll-target="#sec-pipelines-sequential"><span class="header-section-number">7.3</span> Sequential Learner-Pipelines</a>
  <ul class="collapse">
<li><a href="#learners-as-pipeops-and-graphs-as-learners" id="toc-learners-as-pipeops-and-graphs-as-learners" class="nav-link" data-scroll-target="#learners-as-pipeops-and-graphs-as-learners"><span class="header-section-number">7.3.1</span> Learners as PipeOps and Graphs as Learners</a></li>
  <li><a href="#inspecting-graphs" id="toc-inspecting-graphs" class="nav-link" data-scroll-target="#inspecting-graphs"><span class="header-section-number">7.3.2</span> Inspecting Graphs</a></li>
  <li><a href="#accessing-pipeline-hyperparameters" id="toc-accessing-pipeline-hyperparameters" class="nav-link" data-scroll-target="#accessing-pipeline-hyperparameters"><span class="header-section-number">7.3.3</span> Accessing Pipeline Hyperparameters</a></li>
  </ul>
</li>
  <li><a href="#conclusion" id="toc-conclusion" class="nav-link" data-scroll-target="#conclusion"><span class="header-section-number">7.4</span> Conclusion</a></li>
  <li><a href="#exercises" id="toc-exercises" class="nav-link" data-scroll-target="#exercises"><span class="header-section-number">7.5</span> Exercises</a></li>
  <li><a href="#citation" id="toc-citation" class="nav-link" data-scroll-target="#citation"><span class="header-section-number">7.6</span> Citation</a></li>
  </ul><div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/mlr-org/mlr3book/edit/main/book/chapters/chapter7/sequential_pipelines.qmd" class="toc-action">Edit this page</a></p><p><a href="https://github.com/mlr-org/mlr3book/issues/new" class="toc-action">Report an issue</a></p><p><a href="https://github.com/mlr-org/mlr3book/blob/main/book/chapters/chapter7/sequential_pipelines.qmd" class="toc-action">View source</a></p></div></div></nav>
    </div>
<!-- main -->
<main class="content page-columns page-full" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title"><span id="sec-pipelines" class="quarto-section-identifier"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Sequential Pipelines</span></span></h1><button type="button" class="btn code-tools-button" id="quarto-code-tools-source"><i class="bi"></i> Code</button></div></div>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header><p><strong>Martin Binder</strong> <br><em>Ludwig-Maximilians-Universität München, and Munich Center for Machine Learning (MCML)</em></p>
<p><strong>Florian Pfisterer</strong> <br><em>Ludwig-Maximilians-Universität München</em> <br><br></p>
<p><code>mlr3</code> aims to provide a layer of abstraction for ML practitioners, allowing users to quickly swap one algorithm for another without needing expert knowledge of the underlying implementation. A unified interface for <code>Task</code>, <code>Learner</code>, and <code>Measure</code> objects means that complex benchmark experiments can be run in just a few lines of code for any off-the-shelf model, i.e., if you just want to run an experiment using the basic implementation from the underlying algorithm, we hope we have made this easy for you to do.</p>
<p><a href="https://mlr3pipelines.mlr-org.com"><code>mlr3pipelines</code></a> <span class="citation" data-cites="mlr3pipelines">(<a href="#ref-mlr3pipelines" role="doc-biblioref">Binder et al. 2021</a>)</span> takes this modularity one step further, extending it to workflows that may also include data preprocessing (<a href="#sec-preprocessing"><span class="quarto-unresolved-ref">sec-preprocessing</span></a>), building ensemble-models or even more complicated meta-models. <a href="https://mlr3pipelines.mlr-org.com"><code>mlr3pipelines</code></a> makes it possible to build individual steps within a <a href="https://mlr3.mlr-org.com/reference/Learner.html" class="refcode"><code>Learner</code></a> out of building blocks, which inherit from the <a href="https://mlr3pipelines.mlr-org.com/reference/PipeOp.html" class="refcode"><code>PipeOp</code></a> class. <code>PipeOp</code>s can be connected using directed edges to form a <a href="https://mlr3pipelines.mlr-org.com/reference/Graph.html" class="refcode"><code>Graph</code></a> or ‘pipeline’, which represent the flow of data between operations. During model training, the <code>PipeOp</code>s in a <code>Graph</code> transform a given <code>Task</code> and subsequent <code>PipeOp</code>s receive the transformed <code>Task</code> as input. As well as transforming data, <code>PipeOp</code>s generate a <em>state</em>, which is used to inform the <code>PipeOp</code>s operation during prediction, similarly to how learners learn and store model parameters/weights during training that go on to inform model prediction. This is visualized in <a href="#fig-pipelines-state">Figure&nbsp;<span class="quarto-unresolved-ref">fig-pipelines-state</span></a> using the “Scaling” <code>PipeOp</code>, which scales features during training and saves the scaling factors as a state to be used in predictions.</p>
<div class="cell" data-layout-align="center" data-hash="sequential_pipelines_cache/html/fig-pipelines-state_7bbcd03c7b512639ede6326843987293">
<div class="cell-output-display">
<div id="fig-pipelines-state" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="Figures/mlr3book_figures-23.svg" class="quarto-discovered-preview-image img-fluid figure-img" style="width:70.0%" alt="Plot shows a box that says &quot;Dtrain&quot; with an arrow to &quot;Scaling&quot; which itself has an arrow to &quot;Transformed Data&quot;. Below &quot;Dtrain&quot; is a box that says &quot;Dtest&quot; with an arrow to &quot;Scaling; Scaling Factors&quot; which itself has an arrow to &quot;Transformed Data&quot;. There is an arrow pointing from the scaling box on the top row to the one on the bottom. There is also an arrow from the top row scaling box to &quot;Scaling Factors&quot;, the implication is the top row created the scaling factors for the bottom row. Finally there is a curly bracket next to &quot;Scaling Factors&quot; with the text &quot;State (learned parameters)&quot;."></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;7.1: The <code>$train()</code> method of the “Scaling” PipeOp both transforms data (rectangles) as well as creates a state, which is the scaling factors necessary to transform data during prediction.</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>We refer to pipelines as either sequential or non-sequential. These terms should not be confused with “sequential” and “parallel” processing. In the context of pipelines, “sequential” refers to the movement of data through the pipeline from one <code>PipeOp</code> directly to the next from start to finish. Sequential pipelines can be visualized in a straight line – as we will see in this chapter. In contrast, non-sequential pipelines see data being processed through <code>PipeOp</code>s that may have multiple inputs and/or outputs. Non-sequential pipelines are characterized with multiple branches so data may be processed by different <code>PipeOp</code>s at different times. Visually, non-sequential pipelines will not be a straight line from start to finish. In this chapter we will look at sequential pipelines and in the next we will focus on non-sequential pipelines.</p>
<section id="sec-pipelines-pipeops" class="level2 page-columns page-full" data-number="7.1"><h2 data-number="7.1" class="anchored" data-anchor-id="sec-pipelines-pipeops">
<span class="header-section-number">7.1</span> PipeOp: Pipeline Operators</h2>
<div class="page-columns page-full"><p>The basic class of <a href="https://mlr3pipelines.mlr-org.com"><code>mlr3pipelines</code></a> is the <a href="https://mlr3pipelines.mlr-org.com/reference/PipeOp.html" class="refcode"><code>PipeOp</code></a>, short for “pipeline operator”. It represents a transformative operation on input (for example, a training <code>Task</code>), resulting in some output. Similarly to a learner, it includes a <code>$train()</code> and a <code>$predict()</code> method. The training phase typically generates a particular model of the data, which is saved as the internal state. In the prediction phase, the <code>PipeOp</code> acts on the prediction <code>Task</code> using information from the saved state. Therefore, just like a learner, a PipeOp has “parameters” (i.e., the state) that are trained. As well as ‘parameters’, <code>PipeOp</code>s also have hyperparameters that can be set by the user when constructing the <code>PipeOp</code> or by accessing its <code>$param_set</code>. As with other classes, <code>PipeOp</code>s can be constructed with a sugar function, <a href="https://mlr3pipelines.mlr-org.com/reference/po.html" class="refcode"><code>po()</code></a>, or <code><a href="https://mlr3pipelines.mlr-org.com/reference/po.html">pos()</a></code> for multiple <code>PipeOp</code>s, and all available <code>PipeOp</code>s are made available in the dictionary <a href="https://mlr3pipelines.mlr-org.com/reference/mlr_pipeops.html" class="refcode"><code>mlr_pipeops</code></a>.</p><div class="no-row-height column-margin column-container"><span class="">State</span></div></div>
<p>Let us now take a look at a <code>PipeOp</code> in practice using principal component analysis (PCA) as an example, which is implemented in <a href="https://mlr3pipelines.mlr-org.com/reference/mlr_pipeops_pca.html" class="refcode"><code>PipeOpPCA</code></a> implements. Below we construct the <code>PipeOp</code> using its ID <code>"pca"</code> and inspect it.</p>
<div class="cell" data-hash="sequential_pipelines_cache/html/pipeop-intro-1_9782ac791a1858cf8ebeecb701d0457d">
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://mlr3pipelines.mlr-org.com">mlr3pipelines</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">pca</span> <span class="op">=</span> <span class="fu"><a href="https://mlr3pipelines.mlr-org.com/reference/po.html">po</a></span><span class="op">(</span><span class="st">"pca"</span>, center <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">pca</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>PipeOp: &lt;pca&gt; (not trained)
values: &lt;center=TRUE&gt;
Input channels &lt;name [train type, predict type]&gt;:
  input [Task,Task]
Output channels &lt;name [train type, predict type]&gt;:
  output [Task,Task]</code></pre>
</div>
</div>
<p>On printing we can see that the <code>PipeOp</code> has not been trained and that we have changed some of the hyperparameters from their default values. The <code>Input channels</code> and <code>Output channels</code> lines provide information about the input and output types of this PipeOp. The PCA <code>PipeOp</code> takes one input (named “<code>input</code>”) of type “<code>Task</code>”, both during training and prediction (“input <code>[Task,Task]</code>), and produces one called”output” that is also of type “<code>Task</code>” in both phases (“output <code>[Task,Task]</code>) (<a href="#fig-pipeop">Figure&nbsp;<span class="quarto-unresolved-ref">fig-pipeop</span></a>). This highlights a key difference from the <code>Learner</code> class: <code>PipeOp</code>s can return results after the training phase.</p>
<div class="cell" data-layout-align="center" data-hash="sequential_pipelines_cache/html/fig-pipeop_148feace6151e855dabcfc2a1fc62ac0">
<div class="cell-output-display">
<div id="fig-pipeop" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="Figures/mlr3book_figures-19.svg" class="img-fluid figure-img" alt="PipeOp."></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;7.2: PipeOp.</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>The <code>PipeOp</code> can now be trained using <code>$train()</code>, which can have multiple inputs and outputs, which will both be of class <code><a href="https://rdrr.io/r/base/list.html">list()</a></code>. The <code>"pca"</code> <code>PipeOp</code> takes as input the original task and after training returns the task with features replaced by their principal components.</p>
<div class="cell" data-hash="sequential_pipelines_cache/html/05-pipelines-in-depth-003_233b7cb7272065ed996d9ba06ba7f60b">
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">task_small</span> <span class="op">=</span> <span class="fu">tsk</span><span class="op">(</span><span class="st">"penguins_simple"</span><span class="op">)</span><span class="op">$</span><span class="fu">select</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"bill_depth"</span>, <span class="st">"bill_length"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">poin</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">task_small</span><span class="op">$</span><span class="fu">clone</span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="fu">filter</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">poout</span> <span class="op">=</span> <span class="va">pca</span><span class="op">$</span><span class="fu">train</span><span class="op">(</span><span class="va">poin</span><span class="op">)</span></span>
<span><span class="va">poout</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$output
&lt;TaskClassif:penguins&gt; (5 x 3): Simplified Palmer Penguins
* Target: species
* Properties: multiclass
* Features (2):
  - dbl (2): PC1, PC2</code></pre>
</div>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">poout</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="fu">head</span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   species     PC1       PC2
1:  Adelie  0.1561  0.005716
2:  Adelie  1.2677  0.789534
3:  Adelie  1.5336 -0.174460
4:  Adelie -2.1096  0.998977
5:  Adelie -0.8478 -1.619768</code></pre>
</div>
</div>
<p>During training, the PCA transforms incoming data by rotating it in such a way that features become uncorrelated and are ordered by their contribution to total variance. The rotation matrix is also saved in the internal <code>$state</code> field during training (shown in <a href="#fig-pipelines-state">Figure&nbsp;<span class="quarto-unresolved-ref">fig-pipelines-state</span></a>), which can then be accessed during predictions and applied to new data.</p>
<div class="cell" data-hash="sequential_pipelines_cache/html/05-pipelines-in-depth-005_bc4e29670d1c3ed120433177790b61a5">
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">pca</span><span class="op">$</span><span class="va">state</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Standard deviations (1, .., p=2):
[1] 1.513 1.034

Rotation (n x k) = (2 x 2):
                PC1     PC2
bill_depth  -0.6116 -0.7911
bill_length  0.7911 -0.6116</code></pre>
</div>
</div>
<p>Once trained the <code>$predict()</code> function can then access the saved state to operate on the test data, here just a single row passed again as a <code>list</code>.</p>
<div class="cell" data-hash="sequential_pipelines_cache/html/05-pipelines-in-depth-004_8d29766a475ce45c23e536b81d55ced7">
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">task_onepenguin</span> <span class="op">=</span> <span class="va">task_small</span><span class="op">$</span><span class="fu">clone</span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="fu">filter</span><span class="op">(</span><span class="fl">42</span><span class="op">)</span></span>
<span><span class="va">poin</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">task_onepenguin</span><span class="op">)</span></span>
<span><span class="va">poout</span> <span class="op">=</span> <span class="va">pca</span><span class="op">$</span><span class="fu">predict</span><span class="op">(</span><span class="va">poin</span><span class="op">)</span></span>
<span><span class="va">poout</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="fu">data</span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   species   PC1    PC2
1:  Adelie 1.555 -1.455</code></pre>
</div>
</div>
<p>The current list of all PipeOps contained in <a href="https://mlr3pipelines.mlr-org.com"><code>mlr3pipelines</code></a> with links to their documentation can be found at <a href="https://mlr-org.com/pipeops.html">https://mlr-org.com/pipeops.html</a>, a small subset of these are printed below. If you want to extend <a href="https://mlr3pipelines.mlr-org.com"><code>mlr3pipelines</code></a> which a <code>PipeOp</code> that has not been implemented, have a look at our vignette on extending <code>PipeOp</code>s by running: <code><a href="https://mlr3pipelines.mlr-org.com/articles/extending.html">vignette("extending", package = "mlr3pipelines")</a></code>.</p>
<div class="cell" data-hash="sequential_pipelines_cache/html/unnamed-chunk-5_36d7db534ad08133d3174d17bc521a1a">
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/as.data.table.html">as.data.table</a></span><span class="op">(</span><span class="fu"><a href="https://mlr3pipelines.mlr-org.com/reference/po.html">po</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">6</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>              key                                      label
1:         boxcox Box-Cox Transformation of Numeric Features
2:         branch                             Path Branching
3:          chunk          Chunk Input into Multiple Outputs
4: classbalancing                            Class Balancing
5:     classifavg                   Majority Vote Prediction
6:   classweights         Class Weights for Sample Weighting</code></pre>
</div>
</div>
</section><section id="sec-pipelines-graphs" class="level2 page-columns page-full" data-number="7.2"><h2 data-number="7.2" class="anchored" data-anchor-id="sec-pipelines-graphs">
<span class="header-section-number">7.2</span> Graph: Networks of PipeOps</h2>
<p><code>PipeOp</code>s represent individual computational steps in machine learning pipelines. These pipelines themselves are defined by <a href="https://mlr3pipelines.mlr-org.com/reference/Graph.html" class="refcode"><code>Graph</code></a> objects. A <code>Graph</code> is a collection of <code>PipeOp</code>s with “edges” that guide the flow of data.</p>
<div class="page-columns page-full"><p>The most convenient way of building a <code>Graph</code> is to connect a sequence of <code>PipeOp</code>s using the  (read “double-arrow”) operator. When given two <code>PipeOp</code>s, this operator creates a <code>Graph</code> that first executes the left-hand <code>PipeOp</code>, followed by the right-hand one. It can also be used to connect a <code>Graph</code> with a <code>PipeOp</code>, or with another <code>Graph</code>. The following example uses the <code>"mutate"</code> <code>PipeOp</code> to add a new feature to the task, and the <code>"scale"</code> <code>PipeOp</code> to then scale and center all numeric features.</p><div class="no-row-height column-margin column-container"><span class=""><code>%&gt;&gt;%</code></span></div></div>
<div class="cell" data-hash="sequential_pipelines_cache/html/05-sequential-01_7f8ad715ac71ea872c5a859f67c49bbe">
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">po_mutate</span> <span class="op">=</span> <span class="fu"><a href="https://mlr3pipelines.mlr-org.com/reference/po.html">po</a></span><span class="op">(</span><span class="st">"mutate"</span>,</span>
<span>  mutation <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>bill_ratio <span class="op">=</span> <span class="op">~</span><span class="va">bill_length</span> <span class="op">/</span> <span class="va">bill_depth</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">po_scale</span> <span class="op">=</span> <span class="fu"><a href="https://mlr3pipelines.mlr-org.com/reference/po.html">po</a></span><span class="op">(</span><span class="st">"scale"</span><span class="op">)</span></span>
<span><span class="va">gr</span> <span class="op">=</span> <span class="va">po_mutate</span> <span class="op"><a href="https://mlr3pipelines.mlr-org.com/reference/grapes-greater-than-greater-than-grapes.html">%&gt;&gt;%</a></span> <span class="va">po_scale</span></span>
<span><span class="va">gr</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Graph with 2 PipeOps:
     ID         State sccssors prdcssors
 mutate &lt;&lt;UNTRAINED&gt;&gt;    scale          
  scale &lt;&lt;UNTRAINED&gt;&gt;             mutate</code></pre>
</div>
</div>
<div class="page-columns page-full"><p>The output provides information about the layout of the Graph. For each <code>PipOp</code> (<code>ID</code>), we can see information about the state (<code>State</code>), as well as a list of its successors (<code>sccssors</code>), which are <code>PipeOp</code>s that come directly after the given <code>PipeOp</code>, and its predecessors (<code>prdcssors</code>), the <code>PipeOp</code>s that are connected to its input. In this simple <code>Graph</code>, the output of the <code>"mutate"</code> <code>PipeOp</code> is passed directly to the <code>"scale"</code> <code>PipeOp</code> and neither take any other inputs or outputs from other <code>PipeOp</code>s. The <code>$plot()</code> method can be used to visualize the graph.</p><div class="no-row-height column-margin column-container"><span class="">$plot()</span></div></div>
<div class="cell" data-hash="sequential_pipelines_cache/html/05-sequential-01-evalF_68c9d05ec407cb962a9e7e571b59947d">
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">gr</span><span class="op">$</span><span class="fu">plot</span><span class="op">(</span>horizontal <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-hash="sequential_pipelines_cache/html/fig-pipelines-basic-plot_0ee4737d5be5139e6c7b592071d5595f">
<div class="cell-output-display">
<div id="fig-pipelines-basic-plot" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="sequential_pipelines_files/figure-html/fig-pipelines-basic-plot-1.png" class="img-fluid figure-img" alt="Four boxes in a straight line connected by arrows: &quot;<INPUT> -> mutate -> scale -> <OUTPUT>&quot;." width="580"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;7.3: Simple sequential pipeline plot.</figcaption><p></p>
</figure>
</div>
</div>
</div>
<div class="page-columns page-full"><p>The plot demonstrates how a <code>Graph</code> is simply a collection of <code>PipeOp</code>s that are connected by ‘edges’. The collection of <code>PipeOp</code>s inside a <code>Graph</code> can be accessed through the <code>$pipeops</code> field. The <code>$edges</code> field can be used to access edges, which returns a <code>data.table</code> listing the “source” (<code>src_id</code>, <code>src_channel</code>) and “destination” (<code>dst_id</code>, <code>dst_channel</code>) of data flowing along each edge .</p><div class="no-row-height column-margin column-container"><span class=""><code>$edges</code>/<code>$pipeops</code></span></div></div>
<div class="cell" data-hash="sequential_pipelines_cache/html/05-pipelines-in-depth-018-2_4441ffd541d2cecc743f3c7032030680">
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">gr</span><span class="op">$</span><span class="va">pipeops</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$mutate
PipeOp: &lt;mutate&gt; (not trained)
values: &lt;mutation=&lt;list&gt;, delete_originals=FALSE&gt;
Input channels &lt;name [train type, predict type]&gt;:
  input [Task,Task]
Output channels &lt;name [train type, predict type]&gt;:
  output [Task,Task]

$scale
PipeOp: &lt;scale&gt; (not trained)
values: &lt;robust=FALSE&gt;
Input channels &lt;name [train type, predict type]&gt;:
  input [Task,Task]
Output channels &lt;name [train type, predict type]&gt;:
  output [Task,Task]</code></pre>
</div>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">gr</span><span class="op">$</span><span class="va">edges</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   src_id src_channel dst_id dst_channel
1: mutate      output  scale       input</code></pre>
</div>
</div>
<p>Instead of using <code>%&gt;&gt;%</code>, you can also create a <code>Graph</code> explicitly using the <code>$add_pipeop()</code> and <code>$add_edge()</code> methods to create <code>PipeOp</code>s and the edges connecting them:</p>
<div class="cell" data-hash="sequential_pipelines_cache/html/05-pipelines-in-depth-016_17d0cb7d1dadb2ceae2870b43c9ced7f">
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">gr</span> <span class="op">=</span> <span class="va"><a href="https://mlr3pipelines.mlr-org.com/reference/Graph.html">Graph</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="op">)</span><span class="op">$</span></span>
<span>  <span class="fu">add_pipeop</span><span class="op">(</span><span class="va">po_mutate</span><span class="op">)</span><span class="op">$</span> <span class="co"># mutate</span></span>
<span>  <span class="fu">add_pipeop</span><span class="op">(</span><span class="va">po_scale</span><span class="op">)</span><span class="op">$</span> <span class="co"># scale</span></span>
<span>  <span class="fu">add_edge</span><span class="op">(</span><span class="st">"mutate"</span>, <span class="st">"scale"</span><span class="op">)</span> <span class="co"># connect mutate-&gt;scale</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Graphs and DAGs
</div>
</div>
<div class="callout-body-container callout-body">
<p>The <a href="https://mlr3pipelines.mlr-org.com/reference/Graph.html" class="refcode"><code>Graph</code></a> class represents an object similar to a directed acyclic graph (DAG), since the input of a <code>PipeOp</code> cannot depend on its output and hence cycles are not allowed. However, the resemblance to a DAG is not perfect, since the <a href="https://mlr3pipelines.mlr-org.com/reference/Graph.html" class="refcode"><code>Graph</code></a> class allows for multiple edges between nodes. A term such as “directed acyclic multigraph” would be more accurate, but we use “Graph” for simplicity.</p>
</div>
</div>
<p>Once built a <code>Graph</code> can simply be used by calling <code>$train()</code> and <code>$predict()</code> as if it were a <code>Learner</code>, however just like <code>PipeOp</code>s, the output of both training and predicting is a <code>list</code>:</p>
<div class="cell" data-hash="sequential_pipelines_cache/html/05-pipelines-in-depth-019_edd998a09b62955282d145bccd31140e">
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">result</span> <span class="op">=</span> <span class="va">gr</span><span class="op">$</span><span class="fu">train</span><span class="op">(</span><span class="va">task_small</span><span class="op">)</span></span>
<span><span class="va">result</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$scale.output
&lt;TaskClassif:penguins&gt; (333 x 4): Simplified Palmer Penguins
* Target: species
* Properties: multiclass
* Features (3):
  - dbl (3): bill_depth, bill_length, bill_ratio</code></pre>
</div>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">result</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="fu">data</span><span class="op">(</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   species bill_depth bill_length bill_ratio
1:  Adelie     0.7796     -0.8947    -1.0421
2:  Adelie     0.1194     -0.8216    -0.6804
3:  Adelie     0.4241     -0.6753    -0.7435</code></pre>
</div>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">result</span> <span class="op">=</span> <span class="va">gr</span><span class="op">$</span><span class="fu">predict</span><span class="op">(</span><span class="va">task_onepenguin</span><span class="op">)</span></span>
<span><span class="va">result</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="fu">head</span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   species bill_depth bill_length bill_ratio
1:  Adelie     0.9319      -0.529    -0.8963</code></pre>
</div>
</div>
</section><section id="sec-pipelines-sequential" class="level2 page-columns page-full" data-number="7.3"><h2 data-number="7.3" class="anchored" data-anchor-id="sec-pipelines-sequential">
<span class="header-section-number">7.3</span> Sequential Learner-Pipelines</h2>
<p>Possibly the most common application for <a href="https://mlr3pipelines.mlr-org.com"><code>mlr3pipelines</code></a> is to use it to perform preprocessing tasks, such as missing value imputation or factor encoding, and to then feed the resulting data into a <a href="https://mlr3.mlr-org.com/reference/Learner.html" class="refcode"><code>Learner</code></a> – we will see this in practice in <a href="#sec-preprocessing"><span class="quarto-unresolved-ref">sec-preprocessing</span></a>. A <code>Graph</code> representing this workflow manipulates data and fits a <a href="https://mlr3.mlr-org.com/reference/Learner.html" class="refcode"><code>Learner</code></a>-model during training, and uses the fitted model with data that has been similarly preprocessed during prediction. Conceptually, the process may look as shown in <a href="#fig-pipelines-pipeline">Figure&nbsp;<span class="quarto-unresolved-ref">fig-pipelines-pipeline</span></a>.</p>
<div class="cell" data-hash="sequential_pipelines_cache/html/fig-pipelines-pipeline_d0e43be5b66df7fe106d066023ea7122">
<div class="cell-output-display">
<div id="fig-pipelines-pipeline" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="Figures/mlr3book_figures-22.svg" class="img-fluid figure-img" alt="Top pipeline: Dtrain -> Scaling -> Factor Encoding -> Median Imputation -> Decision Tree. Bottom is same as Top except starts with Dtest and at the end has an arrow to Prediction. Each PipeOp in the top row has an arrow to the same PipeOp in the bottom row pointing to a trained state."></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;7.4: Conceptualization of training and prediction process inside a sequential learner-pipeline. During training (top row), the data is passed along the preprocessing operators, each of which modifies the data and creates a <code>$state</code>. Finally, the learner receives the data and a model is created. During prediction (bottom row), data is likewise transformed by preprocessing operators, using their respective <code>$state</code> information in the process. The learner then receives data that has the same format as the data seen during training, and makes a prediction.</figcaption><p></p>
</figure>
</div>
</div>
</div>
<section id="learners-as-pipeops-and-graphs-as-learners" class="level3 page-columns page-full" data-number="7.3.1"><h3 data-number="7.3.1" class="anchored" data-anchor-id="learners-as-pipeops-and-graphs-as-learners">
<span class="header-section-number">7.3.1</span> Learners as PipeOps and Graphs as Learners</h3>
<p>In <a href="#fig-pipelines-pipeline">Figure&nbsp;<span class="quarto-unresolved-ref">fig-pipelines-pipeline</span></a> the final <code>PipeOp</code> is a <code>Learner</code>. <code>Learner</code> objects can be converted to <code>PipeOp</code>s with <a href="https://mlr3pipelines.mlr-org.com/reference/as_pipeop.html" class="refcode"><code>as_pipeop()</code></a>, however this is only necessary if you choose to manually created a graph instead of using <code>%&gt;&gt;%</code>, internally <code>Learner</code>s are wrapped in the <code>"learner"</code> <code>PipeOp</code>. The following code creates a <code>Graph</code> that uses the <code>"imputesample"</code> <code>PipeOp</code> to impute missing values by sampling from observed values (<a href="#sec-preprocessing-missing"><span class="quarto-unresolved-ref">sec-preprocessing-missing</span></a>) then fits a logistic regression on the transformed task.</p>
<div class="cell" data-hash="sequential_pipelines_cache/html/05-pipelines-modeling-1-evalF_cd20ec61228e72260b5f986bd797f8c8">
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">learner_logreg</span> <span class="op">=</span> <span class="fu">lrn</span><span class="op">(</span><span class="st">"classif.log_reg"</span><span class="op">)</span></span>
<span><span class="va">gr</span> <span class="op">=</span> <span class="fu"><a href="https://mlr3pipelines.mlr-org.com/reference/po.html">po</a></span><span class="op">(</span><span class="st">"imputesample"</span><span class="op">)</span> <span class="op"><a href="https://mlr3pipelines.mlr-org.com/reference/grapes-greater-than-greater-than-grapes.html">%&gt;&gt;%</a></span> <span class="va">learner_logreg</span></span>
<span><span class="va">gr</span><span class="op">$</span><span class="fu">plot</span><span class="op">(</span>horizontal <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-hash="sequential_pipelines_cache/html/fig-pipelines-learnerpipeop_f718e7008a41702dc5b694c09a552851">
<div class="cell-output-display">
<div id="fig-pipelines-learnerpipeop" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="sequential_pipelines_files/figure-html/fig-pipelines-learnerpipeop-1.png" class="img-fluid figure-img" alt="Four boxes in a straight line connected by arrows: &quot;<INPUT> -> imputesample -> classif.log_reg -> <OUTPUT>&quot;." width="580"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;7.5: <code>"imputesample"</code> and <code>"learner"</code> PipeOps in a sequential pipeline.</figcaption><p></p>
</figure>
</div>
</div>
</div>
<div class="page-columns page-full"><p>We have seen how training and predicting <code>Graph</code>s is possible but has a slightly different design to <code>Learner</code> objects, i.e., inputs and outputs during both training and predicting are <code><a href="https://rdrr.io/r/base/list.html">list()</a></code> objects. To use a <code>Graph</code> as a <code>Learner</code> with an identical interface, it can be wrapped in a <a href="https://mlr3pipelines.mlr-org.com/reference/mlr_learners_graph.html" class="refcode"><code>GraphLearner</code></a> object with <a href="https://mlr3.mlr-org.com/reference/as_learner.html" class="refcode"><code>as_learner</code></a>. The <code>Graph</code> can then be used like any other <code>Learner</code>, so now we can benchmark our pipeline to decide if we should impute by sampling or with the mode of observed values (<code>po("imputemode")</code>):</p><div class="no-row-height column-margin column-container"><span class=""><code>GraphLearner</code>/<code>as_learner</code></span></div></div>
<div class="cell" data-hash="sequential_pipelines_cache/html/05-pipelines-modeling-3_6bd2390d5b0606b69c0be819babe6ddc">
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">graph_lrn_sample</span> <span class="op">=</span> <span class="fu">as_learner</span><span class="op">(</span><span class="va">gr</span><span class="op">)</span></span>
<span><span class="va">graph_lrn_mode</span> <span class="op">=</span> <span class="fu">as_learner</span><span class="op">(</span><span class="fu"><a href="https://mlr3pipelines.mlr-org.com/reference/po.html">po</a></span><span class="op">(</span><span class="st">"imputemode"</span><span class="op">)</span> <span class="op"><a href="https://mlr3pipelines.mlr-org.com/reference/grapes-greater-than-greater-than-grapes.html">%&gt;&gt;%</a></span> <span class="va">learner_logreg</span><span class="op">)</span></span>
<span></span>
<span><span class="va">grid</span> <span class="op">=</span> <span class="fu">benchmark_grid</span><span class="op">(</span></span>
<span>  <span class="fu">tsk</span><span class="op">(</span><span class="st">"pima"</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">graph_lrn_sample</span>, <span class="va">graph_lrn_mode</span><span class="op">)</span>,</span>
<span>  <span class="fu">rsmp</span><span class="op">(</span><span class="st">"cv"</span>, folds <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">bmr</span> <span class="op">=</span> <span class="fu">benchmark</span><span class="op">(</span><span class="va">grid</span><span class="op">)</span></span>
<span><span class="va">res</span> <span class="op">=</span> <span class="va">bmr</span><span class="op">$</span><span class="fu">aggregate</span><span class="op">(</span><span class="op">)</span><span class="op">[</span>, <span class="fu">.</span><span class="op">(</span><span class="va">learner_id</span>, <span class="va">classif.ce</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">res</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                     learner_id classif.ce
1: imputesample.classif.log_reg     0.2357
2:   imputemode.classif.log_reg     0.2396</code></pre>
</div>
</div>
<p>In this example we can see that the sampling imputation method worked slightly better.</p>
</section><section id="inspecting-graphs" class="level3" data-number="7.3.2"><h3 data-number="7.3.2" class="anchored" data-anchor-id="inspecting-graphs">
<span class="header-section-number">7.3.2</span> Inspecting Graphs</h3>
<p>As with <code>PipeOp</code>s, you may want to inspect pipelines and the flow of data to learn more about your pipeline or to debug any processes. We first need to set the <code>$keep_results</code> flag to be <code>TRUE</code> so that intermediate results are retained, this is turned off by default to save memory.</p>
<div class="cell" data-hash="sequential_pipelines_cache/html/05-pipelines-modeling-debugging_4aa1d99cc57f87b7551e8f5e017eb0c6">
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">graph_lrn_sample</span><span class="op">$</span><span class="va">graph_model</span><span class="op">$</span><span class="va">keep_results</span> <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="va">graph_lrn_sample</span><span class="op">$</span><span class="fu">train</span><span class="op">(</span><span class="fu">tsk</span><span class="op">(</span><span class="st">"pima"</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The <code>Graph</code> can be accessed through the <code>$graph_model</code> field and then <code>PipeOp</code>s can be accessed with <code>$pipeops</code> as before. In this example we can see that our <code>Task</code> no longer has missing data after training the <code>"imputesample"</code> <code>PipeOp</code>:</p>
<div class="cell" data-hash="sequential_pipelines_cache/html/05-pipelines-modeling-debugging-1_0a6a18a34f882ed95c67ac32205bd65c">
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">imputesample_output</span> <span class="op">=</span> <span class="va">graph_lrn_sample</span><span class="op">$</span><span class="va">graph_model</span><span class="op">$</span><span class="va">pipeops</span><span class="op">$</span><span class="va">imputesample</span><span class="op">$</span><span class="va">.result</span></span>
<span><span class="va">imputesample_output</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="fu">missings</span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>diabetes      age pedigree pregnant  glucose  insulin     mass pressure 
       0        0        0        0        0        0        0        0 
 triceps 
       0 </code></pre>
</div>
</div>
<p>We could also use <code>$pipeops</code> to access our underlying <code>Learner</code>, note we need to use <code>$learner_model</code> to get the learner from the <code>PipeOpLearner</code>:</p>
<div class="cell" data-hash="sequential_pipelines_cache/html/05-pipelines-modeling-debugging-2_b2b5889d9f88492b0269be0b6c8a56be">
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">trained_p_logreg</span> <span class="op">=</span> <span class="va">graph_lrn_sample</span><span class="op">$</span><span class="va">graph_model</span><span class="op">$</span><span class="va">pipeops</span><span class="op">$</span><span class="va">classif.log_reg</span></span>
<span><span class="va">trained_l_logreg</span> <span class="op">=</span> <span class="va">trained_p_logreg</span><span class="op">$</span><span class="va">learner_model</span></span>
<span><span class="va">trained_l_logreg</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;LearnerClassifLogReg:classif.log_reg&gt;
* Model: glm
* Parameters: list()
* Packages: mlr3, mlr3learners, stats
* Predict Types:  [response], prob
* Feature Types: logical, integer, numeric, character, factor,
  ordered
* Properties: loglik, twoclass</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<code>$base_learner()</code>
</div>
</div>
<div class="callout-body-container callout-body">
<p>In this example we could have used <code>graph_lrn_sample$base_learner()</code> to immediately access our trained learner, however this does not generalize to more complex pipelines that may contain multiple learners.</p>
</div>
</div>
</section><section id="accessing-pipeline-hyperparameters" class="level3" data-number="7.3.3"><h3 data-number="7.3.3" class="anchored" data-anchor-id="accessing-pipeline-hyperparameters">
<span class="header-section-number">7.3.3</span> Accessing Pipeline Hyperparameters</h3>
<p><code>PipeOp</code> hyperparameters are collected together in the <code>$param_set</code> of a graph and prefixed with the <code>PipeOp</code> IDs to avoid parameter name clashes. Below we use the same <code>PipeOp</code> twice but set the <code>id</code> to ensure their IDs are unique.</p>
<div class="cell" data-hash="sequential_pipelines_cache/html/05-pipelines-in-depth-035_0531cf920b3961918d8b80581bd92a99">
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">gr</span> <span class="op">=</span> <span class="fu"><a href="https://mlr3pipelines.mlr-org.com/reference/po.html">po</a></span><span class="op">(</span><span class="st">"scale"</span>, center <span class="op">=</span> <span class="cn">FALSE</span>, scale <span class="op">=</span> <span class="cn">TRUE</span>, id <span class="op">=</span> <span class="st">"scale"</span><span class="op">)</span> <span class="op"><a href="https://mlr3pipelines.mlr-org.com/reference/grapes-greater-than-greater-than-grapes.html">%&gt;&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://mlr3pipelines.mlr-org.com/reference/po.html">po</a></span><span class="op">(</span><span class="st">"scale"</span>, center <span class="op">=</span> <span class="cn">TRUE</span>, scale <span class="op">=</span> <span class="cn">FALSE</span>, id <span class="op">=</span> <span class="st">"center"</span><span class="op">)</span> <span class="op"><a href="https://mlr3pipelines.mlr-org.com/reference/grapes-greater-than-greater-than-grapes.html">%&gt;&gt;%</a></span></span>
<span>  <span class="fu">lrn</span><span class="op">(</span><span class="st">"classif.rpart"</span>, cp <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span><span class="op">(</span><span class="va">gr</span><span class="op">$</span><span class="va">param_set</span><span class="op">$</span><span class="va">values</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      scale.robust       scale.center        scale.scale 
                 0                  0                  1 
     center.robust      center.center       center.scale 
                 0                  1                  0 
classif.rpart.xval   classif.rpart.cp 
                 0                  1 </code></pre>
</div>
</div>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
PipeOp IDs in Graphs
</div>
</div>
<div class="callout-body-container callout-body">
<p>If you need to change the ID of a <code>PipeOp</code> in a <code>Graph</code> then use the <code>$set_names</code> method from the <code>Graph</code> class, e.g., <code>some_graph$set_names(old = "old_name", new = "new_name")</code>. Do not change the ID of a <code>PipeOp</code> through <code>graph$pipeops$&lt;old_id&gt;$id = &lt;new_id&gt;</code>, as this will only alter the <code>PipeOp</code>’s record of its own ID, and not the <code>Graph</code>’s record, which will lead to errors.</p>
</div>
</div>
<p>Whether a pipeline is treated as a <code>Graph</code> or <code>GraphLearner</code>, hyperparameters are updated and accessed in the same way.</p>
<div class="cell" data-hash="sequential_pipelines_cache/html/unnamed-chunk-6_9ce2cc699e1b8fdaedc1c91755d7edd9">
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">gr</span><span class="op">$</span><span class="va">param_set</span><span class="op">$</span><span class="va">values</span><span class="op">$</span><span class="va">classif.rpart.maxdepth</span> <span class="op">=</span> <span class="fl">5</span></span>
<span><span class="va">lgr</span> <span class="op">=</span> <span class="fu">as_learner</span><span class="op">(</span><span class="va">gr</span><span class="op">)</span></span>
<span><span class="va">lgr</span><span class="op">$</span><span class="va">param_set</span><span class="op">$</span><span class="va">values</span><span class="op">$</span><span class="va">classif.rpart.minsplit</span> <span class="op">=</span> <span class="fl">2</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span><span class="op">(</span><span class="va">lgr</span><span class="op">$</span><span class="va">param_set</span><span class="op">$</span><span class="va">values</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>          scale.center            scale.scale           scale.robust 
                     0                      1                      0 
         center.center           center.scale          center.robust 
                     1                      0                      0 
      classif.rpart.cp classif.rpart.maxdepth classif.rpart.minsplit 
                     1                      5                      2 
    classif.rpart.xval 
                     0 </code></pre>
</div>
</div>
</section></section><section id="conclusion" class="level2" data-number="7.4"><h2 data-number="7.4" class="anchored" data-anchor-id="conclusion">
<span class="header-section-number">7.4</span> Conclusion</h2>
<p>In this chapter, we introduced <a href="https://mlr3pipelines.mlr-org.com"><code>mlr3pipelines</code></a> and its building blocks: <code>Graph</code> and <code>PipeOp</code>. We saw how to create pipelines as <code>Graph</code> objects from multiple <code>PipeOp</code> objects and how to access <code>PipeOp</code>s from a <code>Graph</code>. We also saw how to treat a <code>Learner</code> as a <code>PipeOp</code> and how to treat a <code>Graph</code> as a <code>Learner</code>. In <a href="#sec-pipelines-nonseq"><span class="quarto-unresolved-ref">sec-pipelines-nonseq</span></a> we will take this functionality a step further and look at pipelines where <code>PipeOp</code>s are not executed sequentially, as well as looking at how you can use <a href="https://mlr3tuning.mlr-org.com"><code>mlr3tuning</code></a> to tune pipelines. A lot of practical examples that use sequential pipelines can be found in <a href="#sec-preprocessing"><span class="quarto-unresolved-ref">sec-preprocessing</span></a> where we look at pipelines for data preprocessing.</p>
<p><a href="#tbl-api-pipelines-seq">Table&nbsp;<span class="quarto-unresolved-ref">tbl-api-pipelines-seq</span></a> provides an overview of the most important methods and classes discussed in this chapter.</p>
<div id="tbl-api-pipelines-seq" class="anchored">
<table class="table">
<caption>Table&nbsp;7.1: Important classes and functions covered in this chapter with underlying <code>R6</code> class (if applicable), constructor to create an object of the class, and important class methods.</caption>
<thead><tr class="header">
<th>Underlying R6 Class</th>
<th>Constructor (if applicable)</th>
<th>Important methods</th>
</tr></thead>
<tbody>
<tr class="odd">
<td><a href="https://mlr3pipelines.mlr-org.com/reference/PipeOp.html" class="refcode"><code>PipeOp</code></a></td>
<td><a href="https://mlr3pipelines.mlr-org.com/reference/po.html" class="refcode"><code>po()</code></a></td>
<td>
<code>$train()</code>/<code>$predict()</code>/<code>$state</code>/<code>$id</code>/<code>$param_set</code>
</td>
</tr>
<tr class="even">
<td><a href="https://mlr3pipelines.mlr-org.com/reference/Graph.html" class="refcode"><code>Graph</code></a></td>
<td><code>%&gt;&gt;%</code></td>
<td>
<code>$add_pipeop()</code>/<code>$add_edge()</code>/<code>$pipeops</code>/<code>$edges</code>
</td>
</tr>
</tbody>
</table>
</div>
</section><section id="exercises" class="level2" data-number="7.5"><h2 data-number="7.5" class="anchored" data-anchor-id="exercises">
<span class="header-section-number">7.5</span> Exercises</h2>
<ol type="1">
<li>Create a learner containing a Graph that first imputes missing values using <a href="https://mlr3pipelines.mlr-org.com/reference/mlr_pipeops_imputeoor.html" class="refcode"><code>po("imputeoor")</code></a>, standardizes the data using <a href="https://mlr3pipelines.mlr-org.com/reference/mlr_pipeops_scale.html" class="refcode"><code>po("scale")</code></a>, and then fits a logistic linear model using <a href="https://mlr3learners.mlr-org.com/reference/mlr_learners_classif.log_reg.html" class="refcode"><code>lrn("classif.log_reg")</code></a>.</li>
<li>Train the Graph created in the previous exercise on the <code>pima</code> task and display the coefficients of the resulting model. What are two different ways to access the model?</li>
<li>Verify that the “<code>age</code>” column of the input task of <a href="https://mlr3learners.mlr-org.com/reference/mlr_learners_classif.log_reg.html" class="refcode"><code>lrn("classif.log_reg")</code></a> from the previous exercise is indeed standardized. One way to do this would be to look at the <code>$data</code> field of the <a href="https://mlr3learners.mlr-org.com/reference/mlr_learners_classif.log_reg.html" class="refcode"><code>lrn("classif.log_reg")</code></a> model; however, that is specific to that particular learner and does not work in general. What would be a different, more general way to do this? Hint: use the <code>$keep_results</code> flag.</li>
</ol></section><section id="citation" class="level2" data-number="7.6"><h2 data-number="7.6" class="anchored" data-anchor-id="citation">
<span class="header-section-number">7.6</span> Citation</h2>
<p>Please cite this chapter as:</p>
<p>Binder M, Pfisterer F. (2024). Sequential Pipelines. In Bischl B, Sonabend R, Kotthoff L, Lang M, (Eds.), <em>Applied Machine Learning Using mlr3 in R</em>. CRC Press. https://mlr3book.mlr-org.com/sequential_pipelines.html.</p>


<!-- -->

<div id="refs" class="references csl-bib-body hanging-indent" role="list">
<div id="ref-mlr3pipelines" class="csl-entry" role="listitem">
Binder, Martin, Florian Pfisterer, Michel Lang, Lennart Schneider, Lars Kotthoff, and Bernd Bischl. 2021. <span>“<span class="nocase">mlr3pipelines</span> - Flexible Machine Learning Pipelines in <span>R</span>.”</span> <em>Journal of Machine Learning Research</em> 22 (184): 1–7. <a href="http://jmlr.org/papers/v22/21-0281.html">http://jmlr.org/papers/v22/21-0281.html</a>.
</div>
</div>
</section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><nav class="page-navigation"><div class="nav-page nav-page-previous">
      <a href="../../chapters/chapter6/feature_selection.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Feature Selection</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../../chapters/chapter8/non-sequential_pipelines_and_tuning.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Non-sequential Pipelines and Tuning</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb39" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="fu"># Sequential Pipelines {#sec-pipelines}</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>{{&lt; include ../../common/_setup.qmd &gt;}}</span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a><span class="in">`r chapter = "Sequential Pipelines"`</span></span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a><span class="in">`r authors(chapter)`</span></span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a><span class="in">`mlr3`</span> aims to provide a layer of abstraction for ML practitioners, allowing users to quickly swap one algorithm for another without needing expert knowledge of the underlying implementation.</span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a>A unified interface for <span class="in">`Task`</span>, <span class="in">`Learner`</span>, and <span class="in">`Measure`</span> objects means that complex benchmark experiments can be run in just a few lines of code for any off-the-shelf model, i.e., if you just want to run an experiment using the basic implementation from the underlying algorithm, we hope we have made this easy for you to do.</span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a><span class="in">`r mlr3pipelines`</span> <span class="co">[</span><span class="ot">@mlr3pipelines</span><span class="co">]</span> takes this modularity one step further, extending it to workflows that may also include data <span class="in">`r index('preprocessing')`</span> (@sec-preprocessing), building <span class="in">`r index('ensemble')`</span>-models or even more complicated meta-models.</span>
<span id="cb39-12"><a href="#cb39-12" aria-hidden="true" tabindex="-1"></a><span class="in">`r mlr3pipelines`</span> makes it possible to build individual steps within a <span class="in">`r ref("Learner")`</span> out of building blocks, which inherit from the <span class="in">`r ref("PipeOp", index = TRUE)`</span> class.</span>
<span id="cb39-13"><a href="#cb39-13" aria-hidden="true" tabindex="-1"></a><span class="in">`PipeOp`</span>s can be connected using directed edges to form a <span class="in">`r ref("Graph", index = TRUE)`</span> or 'pipeline', which represent the flow of data between operations.</span>
<span id="cb39-14"><a href="#cb39-14" aria-hidden="true" tabindex="-1"></a>During model training, the <span class="in">`PipeOp`</span>s in a <span class="in">`Graph`</span> transform a given <span class="in">`Task`</span> and subsequent <span class="in">`PipeOp`</span>s receive the transformed <span class="in">`Task`</span> as input.</span>
<span id="cb39-15"><a href="#cb39-15" aria-hidden="true" tabindex="-1"></a>As well as transforming data, <span class="in">`PipeOp`</span>s generate a *state*, which is used to inform the <span class="in">`PipeOp`</span>s operation during prediction, similarly to how learners learn and store model parameters/weights during training that go on to inform model prediction.</span>
<span id="cb39-16"><a href="#cb39-16" aria-hidden="true" tabindex="-1"></a>This is visualized in @fig-pipelines-state using the "Scaling" <span class="in">`PipeOp`</span>, which scales features during training and saves the scaling factors as a state to be used in predictions.</span>
<span id="cb39-17"><a href="#cb39-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-18"><a href="#cb39-18" aria-hidden="true" tabindex="-1"></a><span class="in">```{r fig.align='center'}</span></span>
<span id="cb39-19"><a href="#cb39-19" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-pipelines-state</span></span>
<span id="cb39-20"><a href="#cb39-20" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: 'The `$train()` method of the "Scaling" PipeOp both transforms data (rectangles) as well as creates a state, which is the scaling factors necessary to transform data during prediction.'</span></span>
<span id="cb39-21"><a href="#cb39-21" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-alt: 'Plot shows a box that says "Dtrain" with an arrow to "Scaling" which itself has an arrow to "Transformed Data". Below "Dtrain" is a box that says "Dtest" with an arrow to "Scaling; Scaling Factors" which itself has an arrow to "Transformed Data". There is an arrow pointing from the scaling box on the top row to the one on the bottom. There is also an arrow from the top row scaling box to "Scaling Factors", the implication is the top row created the scaling factors for the bottom row. Finally there is a curly bracket next to "Scaling Factors" with the text "State (learned parameters)".'</span></span>
<span id="cb39-22"><a href="#cb39-22" aria-hidden="true" tabindex="-1"></a><span class="co">#| out.width: "70%"</span></span>
<span id="cb39-23"><a href="#cb39-23" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb39-24"><a href="#cb39-24" aria-hidden="true" tabindex="-1"></a><span class="fu">include_multi_graphics</span>(<span class="st">"Figures/mlr3book_figures-23.svg"</span>, <span class="st">"Figures/mlr3book_figures-23.png"</span>)</span>
<span id="cb39-25"><a href="#cb39-25" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb39-26"><a href="#cb39-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-27"><a href="#cb39-27" aria-hidden="true" tabindex="-1"></a>We refer to pipelines as either sequential or non-sequential.</span>
<span id="cb39-28"><a href="#cb39-28" aria-hidden="true" tabindex="-1"></a>These terms should not be confused with "sequential" and "parallel" processing.</span>
<span id="cb39-29"><a href="#cb39-29" aria-hidden="true" tabindex="-1"></a>In the context of pipelines, "sequential" refers to the movement of data through the pipeline from one <span class="in">`PipeOp`</span> directly to the next from start to finish.</span>
<span id="cb39-30"><a href="#cb39-30" aria-hidden="true" tabindex="-1"></a>Sequential pipelines can be visualized in a straight line -- as we will see in this chapter.</span>
<span id="cb39-31"><a href="#cb39-31" aria-hidden="true" tabindex="-1"></a>In contrast, non-sequential pipelines see data being processed through <span class="in">`PipeOp`</span>s that may have multiple inputs and/or outputs.</span>
<span id="cb39-32"><a href="#cb39-32" aria-hidden="true" tabindex="-1"></a>Non-sequential pipelines are characterized with multiple branches so data may be processed by different <span class="in">`PipeOp`</span>s at different times.</span>
<span id="cb39-33"><a href="#cb39-33" aria-hidden="true" tabindex="-1"></a>Visually, non-sequential pipelines will not be a straight line from start to finish.</span>
<span id="cb39-34"><a href="#cb39-34" aria-hidden="true" tabindex="-1"></a>In this chapter we will look at sequential pipelines and in the next we will focus on non-sequential pipelines.</span>
<span id="cb39-35"><a href="#cb39-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-36"><a href="#cb39-36" aria-hidden="true" tabindex="-1"></a><span class="fu">## PipeOp: Pipeline Operators {#sec-pipelines-pipeops}</span></span>
<span id="cb39-37"><a href="#cb39-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-38"><a href="#cb39-38" aria-hidden="true" tabindex="-1"></a>The basic class of <span class="in">`r mlr3pipelines`</span> is the <span class="in">`r ref("PipeOp", aside = TRUE)`</span>, short for "pipeline operator".</span>
<span id="cb39-39"><a href="#cb39-39" aria-hidden="true" tabindex="-1"></a>It represents a transformative operation on input (for example, a training <span class="in">`Task`</span>), resulting in some output.</span>
<span id="cb39-40"><a href="#cb39-40" aria-hidden="true" tabindex="-1"></a>Similarly to a learner, it includes a <span class="in">`$train()`</span> and a <span class="in">`$predict()`</span> method.</span>
<span id="cb39-41"><a href="#cb39-41" aria-hidden="true" tabindex="-1"></a>The training phase typically generates a particular model of the data, which is saved as the internal <span class="in">`r index("state", aside = TRUE)`</span>.</span>
<span id="cb39-42"><a href="#cb39-42" aria-hidden="true" tabindex="-1"></a>In the prediction phase, the <span class="in">`PipeOp`</span> acts on the prediction <span class="in">`Task`</span> using information from the saved state.</span>
<span id="cb39-43"><a href="#cb39-43" aria-hidden="true" tabindex="-1"></a>Therefore, just like a learner, a PipeOp has "parameters" (i.e., the state) that are trained.</span>
<span id="cb39-44"><a href="#cb39-44" aria-hidden="true" tabindex="-1"></a>As well as 'parameters', <span class="in">`PipeOp`</span>s also have <span class="in">`r index('hyperparameters')`</span> that can be set by the user when constructing the <span class="in">`PipeOp`</span> or by accessing its <span class="in">`$param_set`</span>.</span>
<span id="cb39-45"><a href="#cb39-45" aria-hidden="true" tabindex="-1"></a>As with other classes, <span class="in">`PipeOp`</span>s can be constructed with a sugar function, <span class="in">`r ref("po()", aside = TRUE)`</span>, or <span class="in">`pos()`</span> for multiple <span class="in">`PipeOp`</span>s, and all available <span class="in">`PipeOp`</span>s are made available in the dictionary <span class="in">`r ref("mlr_pipeops", aside = TRUE)`</span>.</span>
<span id="cb39-46"><a href="#cb39-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-47"><a href="#cb39-47" aria-hidden="true" tabindex="-1"></a>Let us now take a look at a <span class="in">`PipeOp`</span> in practice using <span class="in">`r index('principal component analysis')`</span> (PCA)\index{PCA|see{Principal Component Analysis}} as an example, which is implemented in <span class="in">`r ref("PipeOpPCA")`</span> implements.</span>
<span id="cb39-48"><a href="#cb39-48" aria-hidden="true" tabindex="-1"></a>Below we construct the <span class="in">`PipeOp`</span> using its ID <span class="in">`"pca"`</span> and inspect it.</span>
<span id="cb39-49"><a href="#cb39-49" aria-hidden="true" tabindex="-1"></a><span class="in">```{r pipeop-intro-1, eval = TRUE}</span></span>
<span id="cb39-50"><a href="#cb39-50" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mlr3pipelines)</span>
<span id="cb39-51"><a href="#cb39-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-52"><a href="#cb39-52" aria-hidden="true" tabindex="-1"></a>pca <span class="ot">=</span> <span class="fu">po</span>(<span class="st">"pca"</span>, <span class="at">center =</span> <span class="cn">TRUE</span>)</span>
<span id="cb39-53"><a href="#cb39-53" aria-hidden="true" tabindex="-1"></a>pca</span>
<span id="cb39-54"><a href="#cb39-54" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb39-55"><a href="#cb39-55" aria-hidden="true" tabindex="-1"></a>On printing we can see that the <span class="in">`PipeOp`</span> has not been trained and that we have changed some of the hyperparameters from their default values.</span>
<span id="cb39-56"><a href="#cb39-56" aria-hidden="true" tabindex="-1"></a>The <span class="in">`Input channels`</span> and <span class="in">`Output channels`</span> lines provide information about the input and output types of this PipeOp.</span>
<span id="cb39-57"><a href="#cb39-57" aria-hidden="true" tabindex="-1"></a>The PCA <span class="in">`PipeOp`</span> takes one input (named "<span class="in">`input`</span>") of type "<span class="in">`Task`</span>", both during training and prediction ("input <span class="in">`[Task,Task]`</span>), and produces one called "output" that is also of type "<span class="in">`Task`</span>" in both phases ("output <span class="in">`[Task,Task]`</span>) (@fig-pipeop).</span>
<span id="cb39-58"><a href="#cb39-58" aria-hidden="true" tabindex="-1"></a>This highlights a key difference from the <span class="in">`Learner`</span> class: <span class="in">`PipeOp`</span>s can return results after the training phase.</span>
<span id="cb39-59"><a href="#cb39-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-60"><a href="#cb39-60" aria-hidden="true" tabindex="-1"></a><span class="in">```{r fig.align='center'}</span></span>
<span id="cb39-61"><a href="#cb39-61" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-pipeop</span></span>
<span id="cb39-62"><a href="#cb39-62" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: PipeOp.</span></span>
<span id="cb39-63"><a href="#cb39-63" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-alt: PipeOp.</span></span>
<span id="cb39-64"><a href="#cb39-64" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb39-65"><a href="#cb39-65" aria-hidden="true" tabindex="-1"></a><span class="fu">include_multi_graphics</span>(<span class="st">"Figures/mlr3book_figures-19.svg"</span>, <span class="st">"Figures/mlr3book_figures-19.png"</span>)</span>
<span id="cb39-66"><a href="#cb39-66" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb39-67"><a href="#cb39-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-68"><a href="#cb39-68" aria-hidden="true" tabindex="-1"></a>The <span class="in">`PipeOp`</span> can now be trained using <span class="in">`$train()`</span>, which can have multiple inputs and outputs, which will both be of class <span class="in">`list()`</span>.</span>
<span id="cb39-69"><a href="#cb39-69" aria-hidden="true" tabindex="-1"></a>The <span class="in">`"pca"`</span> <span class="in">`PipeOp`</span> takes as input the original task and after training returns the task with features replaced by their principal components.</span>
<span id="cb39-70"><a href="#cb39-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-71"><a href="#cb39-71" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 05-pipelines-in-depth-003, eval = TRUE}</span></span>
<span id="cb39-72"><a href="#cb39-72" aria-hidden="true" tabindex="-1"></a>task_small <span class="ot">=</span> <span class="fu">tsk</span>(<span class="st">"penguins_simple"</span>)<span class="sc">$</span><span class="fu">select</span>(<span class="fu">c</span>(<span class="st">"bill_depth"</span>, <span class="st">"bill_length"</span>))</span>
<span id="cb39-73"><a href="#cb39-73" aria-hidden="true" tabindex="-1"></a>poin <span class="ot">=</span> <span class="fu">list</span>(task_small<span class="sc">$</span><span class="fu">clone</span>()<span class="sc">$</span><span class="fu">filter</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>))</span>
<span id="cb39-74"><a href="#cb39-74" aria-hidden="true" tabindex="-1"></a>poout <span class="ot">=</span> pca<span class="sc">$</span><span class="fu">train</span>(poin)</span>
<span id="cb39-75"><a href="#cb39-75" aria-hidden="true" tabindex="-1"></a>poout</span>
<span id="cb39-76"><a href="#cb39-76" aria-hidden="true" tabindex="-1"></a>poout[[<span class="dv">1</span>]]<span class="sc">$</span><span class="fu">head</span>()</span>
<span id="cb39-77"><a href="#cb39-77" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb39-78"><a href="#cb39-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-79"><a href="#cb39-79" aria-hidden="true" tabindex="-1"></a>During training, the PCA transforms incoming data by rotating it in such a way that features become uncorrelated and are ordered by their contribution to total variance.</span>
<span id="cb39-80"><a href="#cb39-80" aria-hidden="true" tabindex="-1"></a>The rotation matrix is also saved in the internal <span class="in">`$state`</span> field during training (shown in @fig-pipelines-state), which can then be accessed during predictions and applied to new data.</span>
<span id="cb39-81"><a href="#cb39-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-82"><a href="#cb39-82" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 05-pipelines-in-depth-005, eval = TRUE}</span></span>
<span id="cb39-83"><a href="#cb39-83" aria-hidden="true" tabindex="-1"></a>pca<span class="sc">$</span>state</span>
<span id="cb39-84"><a href="#cb39-84" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb39-85"><a href="#cb39-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-86"><a href="#cb39-86" aria-hidden="true" tabindex="-1"></a>Once trained the <span class="in">`$predict()`</span> function can then access the saved state to operate on the test data, here just a single row passed again as a <span class="in">`list`</span>.</span>
<span id="cb39-87"><a href="#cb39-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-88"><a href="#cb39-88" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 05-pipelines-in-depth-004, eval = TRUE}</span></span>
<span id="cb39-89"><a href="#cb39-89" aria-hidden="true" tabindex="-1"></a>task_onepenguin <span class="ot">=</span> task_small<span class="sc">$</span><span class="fu">clone</span>()<span class="sc">$</span><span class="fu">filter</span>(<span class="dv">42</span>)</span>
<span id="cb39-90"><a href="#cb39-90" aria-hidden="true" tabindex="-1"></a>poin <span class="ot">=</span> <span class="fu">list</span>(task_onepenguin)</span>
<span id="cb39-91"><a href="#cb39-91" aria-hidden="true" tabindex="-1"></a>poout <span class="ot">=</span> pca<span class="sc">$</span><span class="fu">predict</span>(poin)</span>
<span id="cb39-92"><a href="#cb39-92" aria-hidden="true" tabindex="-1"></a>poout[[<span class="dv">1</span>]]<span class="sc">$</span><span class="fu">data</span>()</span>
<span id="cb39-93"><a href="#cb39-93" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb39-94"><a href="#cb39-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-95"><a href="#cb39-95" aria-hidden="true" tabindex="-1"></a>The current list of all PipeOps contained in <span class="in">`r mlr3pipelines`</span> with links to their documentation can be found at <span class="in">`r link("https://mlr-org.com/pipeops.html")`</span>, a small subset of these are printed below.</span>
<span id="cb39-96"><a href="#cb39-96" aria-hidden="true" tabindex="-1"></a>If you want to extend <span class="in">`r mlr3pipelines`</span> which a <span class="in">`PipeOp`</span> that has not been implemented, have a look at our vignette on extending <span class="in">`PipeOp`</span>s by running: <span class="in">`vignette("extending", package = "mlr3pipelines")`</span>.</span>
<span id="cb39-97"><a href="#cb39-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-100"><a href="#cb39-100" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb39-101"><a href="#cb39-101" aria-hidden="true" tabindex="-1"></a><span class="fu">as.data.table</span>(<span class="fu">po</span>())[<span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>]</span>
<span id="cb39-102"><a href="#cb39-102" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb39-103"><a href="#cb39-103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-104"><a href="#cb39-104" aria-hidden="true" tabindex="-1"></a><span class="fu">## Graph: Networks of PipeOps {#sec-pipelines-graphs}</span></span>
<span id="cb39-105"><a href="#cb39-105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-106"><a href="#cb39-106" aria-hidden="true" tabindex="-1"></a><span class="in">`PipeOp`</span>s represent individual computational steps in machine learning pipelines.</span>
<span id="cb39-107"><a href="#cb39-107" aria-hidden="true" tabindex="-1"></a>These pipelines themselves are defined by <span class="in">`r ref("Graph", index = TRUE)`</span> objects.</span>
<span id="cb39-108"><a href="#cb39-108" aria-hidden="true" tabindex="-1"></a>A <span class="in">`Graph`</span> is a collection of <span class="in">`PipeOp`</span>s with "edges" that guide the flow of data.</span>
<span id="cb39-109"><a href="#cb39-109" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-110"><a href="#cb39-110" aria-hidden="true" tabindex="-1"></a>The most convenient way of building a <span class="in">`Graph`</span> is to connect a sequence of <span class="in">`PipeOp`</span>s using the <span class="co">[</span><span class="ot">`%&gt;&gt;%`</span><span class="co">]</span>{.aside} \index{\%&gt;&gt;\%} (read "double-arrow") operator.</span>
<span id="cb39-111"><a href="#cb39-111" aria-hidden="true" tabindex="-1"></a>When given two <span class="in">`PipeOp`</span>s, this operator creates a <span class="in">`Graph`</span> that first executes the left-hand <span class="in">`PipeOp`</span>, followed by the right-hand one.</span>
<span id="cb39-112"><a href="#cb39-112" aria-hidden="true" tabindex="-1"></a>It can also be used to connect a <span class="in">`Graph`</span> with a <span class="in">`PipeOp`</span>, or with another <span class="in">`Graph`</span>.</span>
<span id="cb39-113"><a href="#cb39-113" aria-hidden="true" tabindex="-1"></a>The following example uses the <span class="in">`"mutate"`</span> <span class="in">`PipeOp`</span> to add a new feature to the task, and the <span class="in">`"scale"`</span> <span class="in">`PipeOp`</span> to then <span class="in">`r index('scale')`</span> and center all numeric features.</span>
<span id="cb39-114"><a href="#cb39-114" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-115"><a href="#cb39-115" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 05-sequential-01}</span></span>
<span id="cb39-116"><a href="#cb39-116" aria-hidden="true" tabindex="-1"></a>po_mutate <span class="ot">=</span> <span class="fu">po</span>(<span class="st">"mutate"</span>,</span>
<span id="cb39-117"><a href="#cb39-117" aria-hidden="true" tabindex="-1"></a>  <span class="at">mutation =</span> <span class="fu">list</span>(<span class="at">bill_ratio =</span> <span class="sc">~</span>bill_length <span class="sc">/</span> bill_depth)</span>
<span id="cb39-118"><a href="#cb39-118" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb39-119"><a href="#cb39-119" aria-hidden="true" tabindex="-1"></a>po_scale <span class="ot">=</span> <span class="fu">po</span>(<span class="st">"scale"</span>)</span>
<span id="cb39-120"><a href="#cb39-120" aria-hidden="true" tabindex="-1"></a>gr <span class="ot">=</span> po_mutate <span class="sc">%&gt;&gt;%</span> po_scale</span>
<span id="cb39-121"><a href="#cb39-121" aria-hidden="true" tabindex="-1"></a>gr</span>
<span id="cb39-122"><a href="#cb39-122" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb39-123"><a href="#cb39-123" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-124"><a href="#cb39-124" aria-hidden="true" tabindex="-1"></a>The output provides information about the layout of the Graph.</span>
<span id="cb39-125"><a href="#cb39-125" aria-hidden="true" tabindex="-1"></a>For each <span class="in">`PipOp`</span> (<span class="in">`ID`</span>), we can see information about the state (<span class="in">`State`</span>), as well as a list of its successors (<span class="in">`sccssors`</span>), which are <span class="in">`PipeOp`</span>s that come directly after the given <span class="in">`PipeOp`</span>, and its predecessors (<span class="in">`prdcssors`</span>), the <span class="in">`PipeOp`</span>s that are connected to its input.</span>
<span id="cb39-126"><a href="#cb39-126" aria-hidden="true" tabindex="-1"></a>In this simple <span class="in">`Graph`</span>, the output of the <span class="in">`"mutate"`</span> <span class="in">`PipeOp`</span> is passed directly to the <span class="in">`"scale"`</span> <span class="in">`PipeOp`</span> and neither take any other inputs or outputs from other <span class="in">`PipeOp`</span>s.</span>
<span id="cb39-127"><a href="#cb39-127" aria-hidden="true" tabindex="-1"></a>The <span class="in">`r index("$plot()", aside = TRUE, code = TRUE)`</span> method can be used to visualize the graph.</span>
<span id="cb39-128"><a href="#cb39-128" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-129"><a href="#cb39-129" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 05-sequential-01-evalF, eval = FALSE}</span></span>
<span id="cb39-130"><a href="#cb39-130" aria-hidden="true" tabindex="-1"></a>gr<span class="sc">$</span><span class="fu">plot</span>(<span class="at">horizontal =</span> <span class="cn">TRUE</span>)</span>
<span id="cb39-131"><a href="#cb39-131" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb39-132"><a href="#cb39-132" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 05-sequential-01-evalT, eval = TRUE, echo = FALSE}</span></span>
<span id="cb39-133"><a href="#cb39-133" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-pipelines-basic-plot</span></span>
<span id="cb39-134"><a href="#cb39-134" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: Simple sequential pipeline plot.</span></span>
<span id="cb39-135"><a href="#cb39-135" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-alt: 'Four boxes in a straight line connected by arrows: "&lt;INPUT&gt; -&gt; mutate -&gt; scale -&gt; &lt;OUTPUT&gt;".'</span></span>
<span id="cb39-136"><a href="#cb39-136" aria-hidden="true" tabindex="-1"></a>fig <span class="ot">=</span> magick<span class="sc">::</span><span class="fu">image_graph</span>(<span class="at">width =</span> <span class="dv">1500</span>, <span class="at">height =</span> <span class="dv">1000</span>, <span class="at">res =</span> <span class="dv">100</span>, <span class="at">pointsize =</span> <span class="dv">24</span>)</span>
<span id="cb39-137"><a href="#cb39-137" aria-hidden="true" tabindex="-1"></a>gr<span class="sc">$</span><span class="fu">plot</span>(<span class="at">horizontal =</span> <span class="cn">TRUE</span>)</span>
<span id="cb39-138"><a href="#cb39-138" aria-hidden="true" tabindex="-1"></a><span class="fu">invisible</span>(<span class="fu">dev.off</span>())</span>
<span id="cb39-139"><a href="#cb39-139" aria-hidden="true" tabindex="-1"></a>magick<span class="sc">::</span><span class="fu">image_trim</span>(fig)</span>
<span id="cb39-140"><a href="#cb39-140" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb39-141"><a href="#cb39-141" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-142"><a href="#cb39-142" aria-hidden="true" tabindex="-1"></a>The plot demonstrates how a <span class="in">`Graph`</span> is simply a collection of <span class="in">`PipeOp`</span>s that are connected by 'edges'.</span>
<span id="cb39-143"><a href="#cb39-143" aria-hidden="true" tabindex="-1"></a>The collection of <span class="in">`PipeOp`</span>s inside a <span class="in">`Graph`</span> can be accessed through the <span class="in">`$pipeops`</span> \index{\$pipeops} field.</span>
<span id="cb39-144"><a href="#cb39-144" aria-hidden="true" tabindex="-1"></a>The <span class="in">`$edges`</span> \index{\$edges} field can be used to access edges, which returns a <span class="in">`data.table`</span> listing the "source" (<span class="in">`src_id`</span>, <span class="in">`src_channel`</span>) and "destination" (<span class="in">`dst_id`</span>, <span class="in">`dst_channel`</span>) of data flowing along each edge <span class="co">[</span><span class="ot">`$edges`/`$pipeops`</span><span class="co">]</span>{.aside}.</span>
<span id="cb39-145"><a href="#cb39-145" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-146"><a href="#cb39-146" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 05-pipelines-in-depth-018-2, eval = TRUE}</span></span>
<span id="cb39-147"><a href="#cb39-147" aria-hidden="true" tabindex="-1"></a>gr<span class="sc">$</span>pipeops</span>
<span id="cb39-148"><a href="#cb39-148" aria-hidden="true" tabindex="-1"></a>gr<span class="sc">$</span>edges</span>
<span id="cb39-149"><a href="#cb39-149" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb39-150"><a href="#cb39-150" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-151"><a href="#cb39-151" aria-hidden="true" tabindex="-1"></a>Instead of using <span class="in">`%&gt;&gt;%`</span>, you can also create a <span class="in">`Graph`</span> explicitly using the <span class="in">`$add_pipeop()`</span> and <span class="in">`$add_edge()`</span> methods to create <span class="in">`PipeOp`</span>s and the edges connecting them:</span>
<span id="cb39-152"><a href="#cb39-152" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-153"><a href="#cb39-153" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 05-pipelines-in-depth-016}</span></span>
<span id="cb39-154"><a href="#cb39-154" aria-hidden="true" tabindex="-1"></a>gr <span class="ot">=</span> Graph<span class="sc">$</span><span class="fu">new</span>()<span class="sc">$</span></span>
<span id="cb39-155"><a href="#cb39-155" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_pipeop</span>(po_mutate)<span class="sc">$</span> <span class="co"># mutate</span></span>
<span id="cb39-156"><a href="#cb39-156" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_pipeop</span>(po_scale)<span class="sc">$</span> <span class="co"># scale</span></span>
<span id="cb39-157"><a href="#cb39-157" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_edge</span>(<span class="st">"mutate"</span>, <span class="st">"scale"</span>) <span class="co"># connect mutate-&gt;scale</span></span>
<span id="cb39-158"><a href="#cb39-158" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb39-159"><a href="#cb39-159" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-160"><a href="#cb39-160" aria-hidden="true" tabindex="-1"></a>:::{.callout-tip}</span>
<span id="cb39-161"><a href="#cb39-161" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-162"><a href="#cb39-162" aria-hidden="true" tabindex="-1"></a><span class="fu">## Graphs and DAGs</span></span>
<span id="cb39-163"><a href="#cb39-163" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-164"><a href="#cb39-164" aria-hidden="true" tabindex="-1"></a>The <span class="in">`r ref("Graph")`</span> class represents an object similar to a <span class="in">`r index('directed acyclic graph')`</span> (DAG)\index{DAG|see{Directed Acyclic Graph}}, since the input of a <span class="in">`PipeOp`</span> cannot depend on its output and hence cycles are not allowed.</span>
<span id="cb39-165"><a href="#cb39-165" aria-hidden="true" tabindex="-1"></a>However, the resemblance to a DAG is not perfect, since the <span class="in">`r ref("Graph")`</span> class allows for multiple edges between nodes.</span>
<span id="cb39-166"><a href="#cb39-166" aria-hidden="true" tabindex="-1"></a>A term such as "directed acyclic multigraph" would be more accurate, but we use "Graph" for simplicity.</span>
<span id="cb39-167"><a href="#cb39-167" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb39-168"><a href="#cb39-168" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-169"><a href="#cb39-169" aria-hidden="true" tabindex="-1"></a>Once built a <span class="in">`Graph`</span> can simply be used by calling <span class="in">`$train()`</span> and <span class="in">`$predict()`</span> as if it were a <span class="in">`Learner`</span>, however just like <span class="in">`PipeOp`</span>s, the output of both training and predicting is a <span class="in">`list`</span>:</span>
<span id="cb39-170"><a href="#cb39-170" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-171"><a href="#cb39-171" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 05-pipelines-in-depth-019, eval = TRUE}</span></span>
<span id="cb39-172"><a href="#cb39-172" aria-hidden="true" tabindex="-1"></a>result <span class="ot">=</span> gr<span class="sc">$</span><span class="fu">train</span>(task_small)</span>
<span id="cb39-173"><a href="#cb39-173" aria-hidden="true" tabindex="-1"></a>result</span>
<span id="cb39-174"><a href="#cb39-174" aria-hidden="true" tabindex="-1"></a>result[[<span class="dv">1</span>]]<span class="sc">$</span><span class="fu">data</span>()[<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>]</span>
<span id="cb39-175"><a href="#cb39-175" aria-hidden="true" tabindex="-1"></a>result <span class="ot">=</span> gr<span class="sc">$</span><span class="fu">predict</span>(task_onepenguin)</span>
<span id="cb39-176"><a href="#cb39-176" aria-hidden="true" tabindex="-1"></a>result[[<span class="dv">1</span>]]<span class="sc">$</span><span class="fu">head</span>()</span>
<span id="cb39-177"><a href="#cb39-177" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb39-178"><a href="#cb39-178" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-179"><a href="#cb39-179" aria-hidden="true" tabindex="-1"></a><span class="fu">## Sequential Learner-Pipelines {#sec-pipelines-sequential}</span></span>
<span id="cb39-180"><a href="#cb39-180" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-181"><a href="#cb39-181" aria-hidden="true" tabindex="-1"></a>Possibly the most common application for <span class="in">`r mlr3pipelines`</span> is to use it to perform <span class="in">`r index('preprocessing')`</span> tasks, such as missing value <span class="in">`r index('imputation')`</span> or <span class="in">`r index('factor encoding')`</span>, and to then feed the resulting data into a <span class="in">`r ref("Learner")`</span> -- we will see this in practice in @sec-preprocessing.</span>
<span id="cb39-182"><a href="#cb39-182" aria-hidden="true" tabindex="-1"></a>A <span class="in">`Graph`</span> representing this workflow manipulates data and fits a <span class="in">`r ref("Learner")`</span>-model during training, and uses the fitted model with data that has been similarly preprocessed during prediction.</span>
<span id="cb39-183"><a href="#cb39-183" aria-hidden="true" tabindex="-1"></a>Conceptually, the process may look as shown in @fig-pipelines-pipeline.</span>
<span id="cb39-184"><a href="#cb39-184" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-185"><a href="#cb39-185" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 05-pipelines-modeling-002, eval = TRUE, echo = FALSE}</span></span>
<span id="cb39-186"><a href="#cb39-186" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-pipelines-pipeline</span></span>
<span id="cb39-187"><a href="#cb39-187" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Conceptualization of training and prediction process inside a sequential learner-pipeline. During training (top row), the data is passed along the preprocessing operators, each of which modifies the data and creates a `$state`. Finally, the learner receives the data and a model is created. During prediction (bottom row), data is likewise transformed by preprocessing operators, using their respective `$state` information in the process. The learner then receives data that has the same format as the data seen during training, and makes a prediction."</span></span>
<span id="cb39-188"><a href="#cb39-188" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-alt: "Top pipeline: Dtrain -&gt; Scaling -&gt; Factor Encoding -&gt; Median Imputation -&gt; Decision Tree. Bottom is same as Top except starts with Dtest and at the end has an arrow to Prediction. Each PipeOp in the top row has an arrow to the same PipeOp in the bottom row pointing to a trained state."</span></span>
<span id="cb39-189"><a href="#cb39-189" aria-hidden="true" tabindex="-1"></a><span class="fu">include_multi_graphics</span>(<span class="st">"Figures/mlr3book_figures-22.svg"</span>, <span class="st">"Figures/mlr3book_figures-22.png"</span>)</span>
<span id="cb39-190"><a href="#cb39-190" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb39-191"><a href="#cb39-191" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-192"><a href="#cb39-192" aria-hidden="true" tabindex="-1"></a><span class="fu">### Learners as PipeOps and Graphs as Learners</span></span>
<span id="cb39-193"><a href="#cb39-193" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-194"><a href="#cb39-194" aria-hidden="true" tabindex="-1"></a>In @fig-pipelines-pipeline the final <span class="in">`PipeOp`</span> is a <span class="in">`Learner`</span>.</span>
<span id="cb39-195"><a href="#cb39-195" aria-hidden="true" tabindex="-1"></a><span class="in">`Learner`</span> objects can be converted to <span class="in">`PipeOp`</span>s with <span class="in">`r ref("as_pipeop()")`</span>, however this is only necessary if you choose to manually created a graph instead of using <span class="in">`%&gt;&gt;%`</span>, internally <span class="in">`Learner`</span>s are wrapped in the <span class="in">`"learner"`</span> <span class="in">`PipeOp`</span>.</span>
<span id="cb39-196"><a href="#cb39-196" aria-hidden="true" tabindex="-1"></a>The following code creates a <span class="in">`Graph`</span> that uses the <span class="in">`"imputesample"`</span> <span class="in">`PipeOp`</span> to impute missing values by sampling from observed values  (@sec-preprocessing-missing) then fits a <span class="in">`r index('logistic regression')`</span> on the transformed task.</span>
<span id="cb39-197"><a href="#cb39-197" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-198"><a href="#cb39-198" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 05-pipelines-modeling-1-evalF, eval = FALSE}</span></span>
<span id="cb39-199"><a href="#cb39-199" aria-hidden="true" tabindex="-1"></a>learner_logreg <span class="ot">=</span> <span class="fu">lrn</span>(<span class="st">"classif.log_reg"</span>)</span>
<span id="cb39-200"><a href="#cb39-200" aria-hidden="true" tabindex="-1"></a>gr <span class="ot">=</span> <span class="fu">po</span>(<span class="st">"imputesample"</span>) <span class="sc">%&gt;&gt;%</span> learner_logreg</span>
<span id="cb39-201"><a href="#cb39-201" aria-hidden="true" tabindex="-1"></a>gr<span class="sc">$</span><span class="fu">plot</span>(<span class="at">horizontal =</span> <span class="cn">TRUE</span>)</span>
<span id="cb39-202"><a href="#cb39-202" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb39-203"><a href="#cb39-203" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 05-pipelines-modeling-1-evalT, eval = TRUE, echo = FALSE}</span></span>
<span id="cb39-204"><a href="#cb39-204" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-pipelines-learnerpipeop</span></span>
<span id="cb39-205"><a href="#cb39-205" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: '`"imputesample"` and `"learner"` PipeOps in a sequential pipeline.'</span></span>
<span id="cb39-206"><a href="#cb39-206" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-alt: 'Four boxes in a straight line connected by arrows: "&lt;INPUT&gt; -&gt; imputesample -&gt; classif.log_reg -&gt; &lt;OUTPUT&gt;".'</span></span>
<span id="cb39-207"><a href="#cb39-207" aria-hidden="true" tabindex="-1"></a>learner_logreg <span class="ot">=</span> <span class="fu">lrn</span>(<span class="st">"classif.log_reg"</span>)</span>
<span id="cb39-208"><a href="#cb39-208" aria-hidden="true" tabindex="-1"></a>gr <span class="ot">=</span> <span class="fu">po</span>(<span class="st">"imputesample"</span>) <span class="sc">%&gt;&gt;%</span> learner_logreg</span>
<span id="cb39-209"><a href="#cb39-209" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-210"><a href="#cb39-210" aria-hidden="true" tabindex="-1"></a>fig <span class="ot">=</span> magick<span class="sc">::</span><span class="fu">image_graph</span>(<span class="at">width =</span> <span class="dv">1500</span>, <span class="at">height =</span> <span class="dv">1000</span>, <span class="at">res =</span> <span class="dv">100</span>, <span class="at">pointsize =</span> <span class="dv">24</span>)</span>
<span id="cb39-211"><a href="#cb39-211" aria-hidden="true" tabindex="-1"></a>gr<span class="sc">$</span><span class="fu">plot</span>(<span class="at">horizontal =</span> <span class="cn">TRUE</span>)</span>
<span id="cb39-212"><a href="#cb39-212" aria-hidden="true" tabindex="-1"></a><span class="fu">invisible</span>(<span class="fu">dev.off</span>())</span>
<span id="cb39-213"><a href="#cb39-213" aria-hidden="true" tabindex="-1"></a>magick<span class="sc">::</span><span class="fu">image_trim</span>(fig)</span>
<span id="cb39-214"><a href="#cb39-214" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb39-215"><a href="#cb39-215" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-216"><a href="#cb39-216" aria-hidden="true" tabindex="-1"></a>We have seen how training and predicting <span class="in">`Graph`</span>s is possible but has a slightly different design to <span class="in">`Learner`</span> objects, i.e., inputs and outputs during both training and predicting are <span class="in">`list()`</span> objects.</span>
<span id="cb39-217"><a href="#cb39-217" aria-hidden="true" tabindex="-1"></a>To use a <span class="in">`Graph`</span> as a <span class="in">`Learner`</span> with an identical interface, it can be wrapped in a <span class="in">`r ref("GraphLearner", index = TRUE)`</span> object with <span class="in">`r ref("as_learner", index = TRUE)`</span><span class="co">[</span><span class="ot">`GraphLearner`/`as_learner`</span><span class="co">]</span>{.aside}.</span>
<span id="cb39-218"><a href="#cb39-218" aria-hidden="true" tabindex="-1"></a>The <span class="in">`Graph`</span> can then be used like any other <span class="in">`Learner`</span>, so now we can benchmark our pipeline to decide if we should impute by sampling or with the mode of observed values (<span class="in">`po("imputemode")`</span>):</span>
<span id="cb39-219"><a href="#cb39-219" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-220"><a href="#cb39-220" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 05-pipelines-modeling-3}</span></span>
<span id="cb39-221"><a href="#cb39-221" aria-hidden="true" tabindex="-1"></a>graph_lrn_sample <span class="ot">=</span> <span class="fu">as_learner</span>(gr)</span>
<span id="cb39-222"><a href="#cb39-222" aria-hidden="true" tabindex="-1"></a>graph_lrn_mode <span class="ot">=</span> <span class="fu">as_learner</span>(<span class="fu">po</span>(<span class="st">"imputemode"</span>) <span class="sc">%&gt;&gt;%</span> learner_logreg)</span>
<span id="cb39-223"><a href="#cb39-223" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-224"><a href="#cb39-224" aria-hidden="true" tabindex="-1"></a>grid <span class="ot">=</span> <span class="fu">benchmark_grid</span>(</span>
<span id="cb39-225"><a href="#cb39-225" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tsk</span>(<span class="st">"pima"</span>),</span>
<span id="cb39-226"><a href="#cb39-226" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(graph_lrn_sample, graph_lrn_mode),</span>
<span id="cb39-227"><a href="#cb39-227" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rsmp</span>(<span class="st">"cv"</span>, <span class="at">folds =</span> <span class="dv">3</span>)</span>
<span id="cb39-228"><a href="#cb39-228" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb39-229"><a href="#cb39-229" aria-hidden="true" tabindex="-1"></a>bmr <span class="ot">=</span> <span class="fu">benchmark</span>(grid)</span>
<span id="cb39-230"><a href="#cb39-230" aria-hidden="true" tabindex="-1"></a>res <span class="ot">=</span> bmr<span class="sc">$</span><span class="fu">aggregate</span>()[, .(learner_id, classif.ce)]</span>
<span id="cb39-231"><a href="#cb39-231" aria-hidden="true" tabindex="-1"></a>res</span>
<span id="cb39-232"><a href="#cb39-232" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb39-233"><a href="#cb39-233" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-234"><a href="#cb39-234" aria-hidden="true" tabindex="-1"></a>In this example we can see that the <span class="in">`r c("sampling", "mode")[which.min(unlist(res[,2]))]`</span> imputation method worked slightly better.</span>
<span id="cb39-235"><a href="#cb39-235" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-236"><a href="#cb39-236" aria-hidden="true" tabindex="-1"></a><span class="fu">### Inspecting Graphs</span></span>
<span id="cb39-237"><a href="#cb39-237" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-238"><a href="#cb39-238" aria-hidden="true" tabindex="-1"></a>As with <span class="in">`PipeOp`</span>s, you may want to inspect pipelines and the flow of data to learn more about your pipeline or to debug any processes.</span>
<span id="cb39-239"><a href="#cb39-239" aria-hidden="true" tabindex="-1"></a>We first need to set the <span class="in">`$keep_results`</span> flag to be <span class="in">`TRUE`</span> so that intermediate results are retained, this is turned off by default to save memory.</span>
<span id="cb39-240"><a href="#cb39-240" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-241"><a href="#cb39-241" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 05-pipelines-modeling-debugging, eval = TRUE}</span></span>
<span id="cb39-242"><a href="#cb39-242" aria-hidden="true" tabindex="-1"></a>graph_lrn_sample<span class="sc">$</span>graph_model<span class="sc">$</span>keep_results <span class="ot">=</span> <span class="cn">TRUE</span></span>
<span id="cb39-243"><a href="#cb39-243" aria-hidden="true" tabindex="-1"></a>graph_lrn_sample<span class="sc">$</span><span class="fu">train</span>(<span class="fu">tsk</span>(<span class="st">"pima"</span>))</span>
<span id="cb39-244"><a href="#cb39-244" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb39-245"><a href="#cb39-245" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-246"><a href="#cb39-246" aria-hidden="true" tabindex="-1"></a>The <span class="in">`Graph`</span> can be accessed through the <span class="in">`$graph_model`</span> field and then <span class="in">`PipeOp`</span>s can be accessed with <span class="in">`$pipeops`</span> as before.</span>
<span id="cb39-247"><a href="#cb39-247" aria-hidden="true" tabindex="-1"></a>In this example we can see that our <span class="in">`Task`</span> no longer has missing data after training the <span class="in">`"imputesample"`</span> <span class="in">`PipeOp`</span>:</span>
<span id="cb39-248"><a href="#cb39-248" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-249"><a href="#cb39-249" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 05-pipelines-modeling-debugging-1, eval = TRUE}</span></span>
<span id="cb39-250"><a href="#cb39-250" aria-hidden="true" tabindex="-1"></a>imputesample_output <span class="ot">=</span> graph_lrn_sample<span class="sc">$</span>graph_model<span class="sc">$</span>pipeops<span class="sc">$</span>imputesample<span class="sc">$</span>.result</span>
<span id="cb39-251"><a href="#cb39-251" aria-hidden="true" tabindex="-1"></a>imputesample_output[[<span class="dv">1</span>]]<span class="sc">$</span><span class="fu">missings</span>()</span>
<span id="cb39-252"><a href="#cb39-252" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb39-253"><a href="#cb39-253" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-254"><a href="#cb39-254" aria-hidden="true" tabindex="-1"></a>We could also use <span class="in">`$pipeops`</span> to access our underlying <span class="in">`Learner`</span>, note we need to use <span class="in">`$learner_model`</span> to get the learner from the <span class="in">`PipeOpLearner`</span>:</span>
<span id="cb39-255"><a href="#cb39-255" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-256"><a href="#cb39-256" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 05-pipelines-modeling-debugging-2, eval = TRUE}</span></span>
<span id="cb39-257"><a href="#cb39-257" aria-hidden="true" tabindex="-1"></a>trained_p_logreg <span class="ot">=</span> graph_lrn_sample<span class="sc">$</span>graph_model<span class="sc">$</span>pipeops<span class="sc">$</span>classif.log_reg</span>
<span id="cb39-258"><a href="#cb39-258" aria-hidden="true" tabindex="-1"></a>trained_l_logreg <span class="ot">=</span> trained_p_logreg<span class="sc">$</span>learner_model</span>
<span id="cb39-259"><a href="#cb39-259" aria-hidden="true" tabindex="-1"></a>trained_l_logreg</span>
<span id="cb39-260"><a href="#cb39-260" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb39-261"><a href="#cb39-261" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-262"><a href="#cb39-262" aria-hidden="true" tabindex="-1"></a>:::{.callout-tip}</span>
<span id="cb39-263"><a href="#cb39-263" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-264"><a href="#cb39-264" aria-hidden="true" tabindex="-1"></a><span class="fu">## `$base_learner()`</span></span>
<span id="cb39-265"><a href="#cb39-265" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-266"><a href="#cb39-266" aria-hidden="true" tabindex="-1"></a>In this example we could have used <span class="in">`graph_lrn_sample$base_learner()`</span> to immediately access our trained learner, however this does not generalize to more complex pipelines that may contain multiple learners.</span>
<span id="cb39-267"><a href="#cb39-267" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb39-268"><a href="#cb39-268" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-269"><a href="#cb39-269" aria-hidden="true" tabindex="-1"></a><span class="fu">### Accessing Pipeline Hyperparameters</span></span>
<span id="cb39-270"><a href="#cb39-270" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-271"><a href="#cb39-271" aria-hidden="true" tabindex="-1"></a><span class="in">`PipeOp`</span> hyperparameters are collected together in the <span class="in">`$param_set`</span> of a graph and prefixed with the <span class="in">`PipeOp`</span> IDs to avoid parameter name clashes.</span>
<span id="cb39-272"><a href="#cb39-272" aria-hidden="true" tabindex="-1"></a>Below we use the same <span class="in">`PipeOp`</span> twice but set the <span class="in">`id`</span> to ensure their IDs are unique.</span>
<span id="cb39-273"><a href="#cb39-273" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-274"><a href="#cb39-274" aria-hidden="true" tabindex="-1"></a><span class="in">```{r 05-pipelines-in-depth-035, eval = TRUE}</span></span>
<span id="cb39-275"><a href="#cb39-275" aria-hidden="true" tabindex="-1"></a>gr <span class="ot">=</span> <span class="fu">po</span>(<span class="st">"scale"</span>, <span class="at">center =</span> <span class="cn">FALSE</span>, <span class="at">scale =</span> <span class="cn">TRUE</span>, <span class="at">id =</span> <span class="st">"scale"</span>) <span class="sc">%&gt;&gt;%</span></span>
<span id="cb39-276"><a href="#cb39-276" aria-hidden="true" tabindex="-1"></a>  <span class="fu">po</span>(<span class="st">"scale"</span>, <span class="at">center =</span> <span class="cn">TRUE</span>, <span class="at">scale =</span> <span class="cn">FALSE</span>, <span class="at">id =</span> <span class="st">"center"</span>) <span class="sc">%&gt;&gt;%</span></span>
<span id="cb39-277"><a href="#cb39-277" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lrn</span>(<span class="st">"classif.rpart"</span>, <span class="at">cp =</span> <span class="dv">1</span>)</span>
<span id="cb39-278"><a href="#cb39-278" aria-hidden="true" tabindex="-1"></a><span class="fu">unlist</span>(gr<span class="sc">$</span>param_set<span class="sc">$</span>values)</span>
<span id="cb39-279"><a href="#cb39-279" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb39-280"><a href="#cb39-280" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-281"><a href="#cb39-281" aria-hidden="true" tabindex="-1"></a>:::{.callout-warning}</span>
<span id="cb39-282"><a href="#cb39-282" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-283"><a href="#cb39-283" aria-hidden="true" tabindex="-1"></a><span class="fu">## PipeOp IDs in Graphs</span></span>
<span id="cb39-284"><a href="#cb39-284" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-285"><a href="#cb39-285" aria-hidden="true" tabindex="-1"></a>If you need to change the ID of a <span class="in">`PipeOp`</span> in a <span class="in">`Graph`</span> then use the <span class="in">`$set_names`</span> method from the <span class="in">`Graph`</span> class, e.g., <span class="in">`some_graph$set_names(old = "old_name", new = "new_name")`</span>.</span>
<span id="cb39-286"><a href="#cb39-286" aria-hidden="true" tabindex="-1"></a>Do not change the ID of a <span class="in">`PipeOp`</span> through <span class="in">`graph$pipeops$&lt;old_id&gt;$id = &lt;new_id&gt;`</span>, as this will only alter the <span class="in">`PipeOp`</span>'s record of its own ID, and not the <span class="in">`Graph`</span>'s record, which will lead to errors.</span>
<span id="cb39-287"><a href="#cb39-287" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb39-288"><a href="#cb39-288" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-289"><a href="#cb39-289" aria-hidden="true" tabindex="-1"></a>Whether a pipeline is treated as a <span class="in">`Graph`</span> or <span class="in">`GraphLearner`</span>, hyperparameters are updated and accessed in the same way.</span>
<span id="cb39-290"><a href="#cb39-290" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-293"><a href="#cb39-293" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb39-294"><a href="#cb39-294" aria-hidden="true" tabindex="-1"></a>gr<span class="sc">$</span>param_set<span class="sc">$</span>values<span class="sc">$</span>classif.rpart.maxdepth <span class="ot">=</span> <span class="dv">5</span></span>
<span id="cb39-295"><a href="#cb39-295" aria-hidden="true" tabindex="-1"></a>lgr <span class="ot">=</span> <span class="fu">as_learner</span>(gr)</span>
<span id="cb39-296"><a href="#cb39-296" aria-hidden="true" tabindex="-1"></a>lgr<span class="sc">$</span>param_set<span class="sc">$</span>values<span class="sc">$</span>classif.rpart.minsplit <span class="ot">=</span> <span class="dv">2</span></span>
<span id="cb39-297"><a href="#cb39-297" aria-hidden="true" tabindex="-1"></a><span class="fu">unlist</span>(lgr<span class="sc">$</span>param_set<span class="sc">$</span>values)</span>
<span id="cb39-298"><a href="#cb39-298" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb39-299"><a href="#cb39-299" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-300"><a href="#cb39-300" aria-hidden="true" tabindex="-1"></a><span class="fu">## Conclusion</span></span>
<span id="cb39-301"><a href="#cb39-301" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-302"><a href="#cb39-302" aria-hidden="true" tabindex="-1"></a>In this chapter, we introduced <span class="in">`r mlr3pipelines`</span> and its building blocks: <span class="in">`Graph`</span> and <span class="in">`PipeOp`</span>.</span>
<span id="cb39-303"><a href="#cb39-303" aria-hidden="true" tabindex="-1"></a>We saw how to create pipelines as <span class="in">`Graph`</span> objects from multiple <span class="in">`PipeOp`</span> objects and how to access <span class="in">`PipeOp`</span>s from a <span class="in">`Graph`</span>.</span>
<span id="cb39-304"><a href="#cb39-304" aria-hidden="true" tabindex="-1"></a>We also saw how to treat a <span class="in">`Learner`</span> as a <span class="in">`PipeOp`</span> and how to treat a <span class="in">`Graph`</span> as a <span class="in">`Learner`</span>.</span>
<span id="cb39-305"><a href="#cb39-305" aria-hidden="true" tabindex="-1"></a>In @sec-pipelines-nonseq we will take this functionality a step further and look at pipelines where <span class="in">`PipeOp`</span>s are not executed sequentially, as well as looking at how you can use <span class="in">`r mlr3tuning`</span> to tune pipelines.</span>
<span id="cb39-306"><a href="#cb39-306" aria-hidden="true" tabindex="-1"></a>A lot of practical examples that use sequential pipelines can be found in @sec-preprocessing where we look at pipelines for data preprocessing.</span>
<span id="cb39-307"><a href="#cb39-307" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-308"><a href="#cb39-308" aria-hidden="true" tabindex="-1"></a>@tbl-api-pipelines-seq provides an overview of the most important methods and classes discussed in this chapter.</span>
<span id="cb39-309"><a href="#cb39-309" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-310"><a href="#cb39-310" aria-hidden="true" tabindex="-1"></a>| Underlying R6 Class | Constructor (if applicable) | Important methods |</span>
<span id="cb39-311"><a href="#cb39-311" aria-hidden="true" tabindex="-1"></a>| --------------------------- | --------------------- | -------------------------------------------- |</span>
<span id="cb39-312"><a href="#cb39-312" aria-hidden="true" tabindex="-1"></a>| <span class="in">`r ref("PipeOp")`</span> | <span class="in">`r ref("po()")`</span> | <span class="in">`$train()`</span>/<span class="in">`$predict()`</span>/<span class="in">`$state`</span>/<span class="in">`$id`</span>/<span class="in">`$param_set`</span> |</span>
<span id="cb39-313"><a href="#cb39-313" aria-hidden="true" tabindex="-1"></a>| <span class="in">`r ref("Graph")`</span> | <span class="in">`%&gt;&gt;%`</span> | <span class="in">`$add_pipeop()`</span>/<span class="in">`$add_edge()`</span>/<span class="in">`$pipeops`</span>/<span class="in">`$edges`</span> |</span>
<span id="cb39-314"><a href="#cb39-314" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-315"><a href="#cb39-315" aria-hidden="true" tabindex="-1"></a>: Important classes and functions covered in this chapter with underlying <span class="in">`R6`</span> class (if applicable), constructor to create an object of the class, and important class methods. {#tbl-api-pipelines-seq}</span>
<span id="cb39-316"><a href="#cb39-316" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-317"><a href="#cb39-317" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-318"><a href="#cb39-318" aria-hidden="true" tabindex="-1"></a><span class="fu">## Exercises</span></span>
<span id="cb39-319"><a href="#cb39-319" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-320"><a href="#cb39-320" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>Create a learner containing a Graph that first imputes missing values using <span class="in">`r ref("PipeOpImputeOOR", "po(\"imputeoor\")")`</span>, standardizes the data using <span class="in">`r ref("PipeOpScale", "po(\"scale\")")`</span>, and then fits a logistic linear model using <span class="in">`r ref("LearnerClassifLogReg", "lrn(\"classif.log_reg\")")`</span>.</span>
<span id="cb39-321"><a href="#cb39-321" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>Train the Graph created in the previous exercise on the <span class="in">`pima`</span> task and display the coefficients of the resulting model.</span>
<span id="cb39-322"><a href="#cb39-322" aria-hidden="true" tabindex="-1"></a>  What are two different ways to access the model?</span>
<span id="cb39-323"><a href="#cb39-323" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>Verify that the "<span class="in">`age`</span>" column of the input task of <span class="in">`r ref("LearnerClassifLogReg", "lrn(\"classif.log_reg\")")`</span> from the previous exercise is indeed standardized.</span>
<span id="cb39-324"><a href="#cb39-324" aria-hidden="true" tabindex="-1"></a>  One way to do this would be to look at the <span class="in">`$data`</span> field of the <span class="in">`r ref("LearnerClassifLogReg", "lrn(\"classif.log_reg\")")`</span> model; however, that is specific to that particular learner and does not work in general.</span>
<span id="cb39-325"><a href="#cb39-325" aria-hidden="true" tabindex="-1"></a>  What would be a different, more general way to do this?</span>
<span id="cb39-326"><a href="#cb39-326" aria-hidden="true" tabindex="-1"></a>  Hint: use the <span class="in">`$keep_results`</span> flag.</span>
<span id="cb39-327"><a href="#cb39-327" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-328"><a href="#cb39-328" aria-hidden="true" tabindex="-1"></a>::: {.content-visible when-format="html"}</span>
<span id="cb39-329"><a href="#cb39-329" aria-hidden="true" tabindex="-1"></a><span class="in">`r citeas(chapter)`</span></span>
<span id="cb39-330"><a href="#cb39-330" aria-hidden="true" tabindex="-1"></a>:::</span>
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->
<footer class="footer"><div class="nav-footer">
    <div class="nav-footer-left">All content licensed under <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> <br> © Bernd Bischl, Raphael Sonabend, Lars Kotthoff, Michel Lang.</div>   
    <div class="nav-footer-center"><a href="https://mlr-org.com">Website</a> | <a href="https://github.com/mlr-org/mlr3book">GitHub</a> | <a href="https://mlr-org.com/gallery">Gallery</a> | <a href="https://lmmisld-lmu-stats-slds.srv.mwn.de/mlr_invite/">Mattermost</a></div>
    <div class="nav-footer-right">Built with <a href="https://quarto.org/">Quarto</a>.</div>
  </div>
</footer>


<script src="../../site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>