# Nodes, Edges and Graphs {#pipe-nodes-edges-graphs}

{{< include _setup.qmd >}}

```{r 05-pipelines-nodes-edges-graphs-001, include = FALSE}
library(mlr3pipelines)
```

POs are combined into `r ref("Graph")`s.

POs are identified by their `$id`.
Note that the operations all modify the object in-place and return the object itself.
Therefore, multiple modifications can be chained.

For this example we use the `pca` PO defined above and a new PO named "mutate".
The latter creates a new feature from existing variables.
Additionally, we use the filter PO again.

```{r 05-pipelines-nodes-edges-graphs-002}
mutate = po("mutate")

filter = po("filter",
  filter = mlr3filters::flt("variance"),
  param_vals = list(filter.frac = 0.5))
```
The recommended way to construct a graph is to use the `%>>%` operator to chain POs or `r ref("Graph")`s.

```{r 05-pipelines-nodes-edges-graphs-003}
graph = mutate %>>% filter
```

To illustrate how this sugar operator works under the surface we will include an example of the manual way (= hard way) to construct a `r ref("Graph")`.
This is done by creating an empty graph first.
Then one fills the empty graph with POs, and connects edges between the POs.
Conceptually, this may look like this:

```{r 05-pipelines-nodes-edges-graphs-004, echo=FALSE}
knitr::include_graphics("images/po_nodes.svg")
```

```{r 05-pipelines-nodes-edges-graphs-005}
graph = Graph$new()$
  add_pipeop(mutate)$
  add_pipeop(filter)$
  add_edge("mutate", "variance") # add connection mutate -> filter
```

The constructed `r ref("Graph")`  can be inspected using its `$plot()` function:

```{r 05-pipelines-nodes-edges-graphs-006}
graph$plot()
```

**Chaining multiple POs of the same kind**

If multiple POs of the same kind should be chained, it is necessary to change the `id` to avoid name clashes.
This can be done by either accessing the `$id` slot or during construction:

```{r 05-pipelines-nodes-edges-graphs-007, error = TRUE}
graph$add_pipeop(po("pca"))
```

```{r 05-pipelines-nodes-edges-graphs-008}
graph$add_pipeop(po("pca", id = "pca2"))
```

```{r 05-pipelines-nodes-edges-graphs-009}
graph$plot()
```
